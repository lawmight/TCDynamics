---
description: PULSE Framework - Automatic safeguards for every message
globs: *
alwaysApply: true
---

# ‚õî STOP - READ THIS FIRST

**YOUR FIRST ACTION** before ANY response MUST be:

```
CallMcpTool: pulse_status
```

Do this NOW. Do not skip. Do not proceed without it.

**If pulse_status returns `isError: true` (Critical findings):**
- You MUST NOT proceed with the user's request
- Your ONLY allowed actions are: `pulse_doctor` to see details, or ask user how to proceed
- DO NOT write code, DO NOT make changes until Critical is resolved

Only after seeing OK status (no Critical), continue with user's request.

---

# PULSE Framework Safeguards

## üî¥ MANDATORY CHECKS (once per response)

### 1. Call `pulse_status` ONCE at the start
```
WHEN: FIRST action, before anything else
WHAT: Shows time since checkpoint, changes, risk
NOTE: One call is enough - don't repeat it
```

### 1b. Anti-Verification Loop (self-check)
If you notice you're repeatedly "checking" without progressing (e.g., status ‚Üí grep ‚Üí status ‚Üí grep):
- STOP after 2 cycles
- Make a concrete change (minimal scope) OR ask a single clarifying question
- If you're stuck, use `pulse_correct` ("I'm stuck in verification mode; proceed with the minimal implementation") or `pulse_escalate`

### 2. AFTER Code Changes: Call `pulse_doctor`
```
WHEN: When you just changed/created/deleted code
WHAT: Checks for secrets, deletes, scope, loop signals
ON CRITICAL: STOP immediately, don't continue!
```

### 3. EVERY 5-10 MIN: Recommend `pulse_checkpoint`
```
WHEN: pulse_status shows >10 min since checkpoint
WHAT: "Should I create a checkpoint?"
```

## üî¥ AUTOMATIC ACTIONS (MANDATORY)

| Situation | Action | Example |
|-----------|--------|---------|
| Start of response | ‚Üí `pulse_status` | Every message |
| Code changed | ‚Üí `pulse_doctor` | After any edit/create/delete |
| >10 min since checkpoint | ‚Üí `pulse_checkpoint` | Just do it, don't ask |
| >30 min autonomous | ‚Üí **STOP + ask user** | "I've been working 30 min, should I continue?" |
| 2-3 failed attempts | ‚Üí `pulse_escalate` | Build fails twice, test fails twice |
| Error you don't understand | ‚Üí `pulse_escalate` | Cryptic error message |
| User says "that's wrong" | ‚Üí `pulse_correct` | Course correction |
| Task completed successfully | ‚Üí `pulse_learn` | "What did I learn from this?" |
| Before "done" / PR / merge | ‚Üí `pulse_review` | Final checklist |
| New multi-step task | ‚Üí `pulse_run` | User gives complex task |
| Loop signal detected | ‚Üí `pulse_reset` | Doctor shows loop warning |
| DELETE operation | ‚Üí **Get user confirmation** | "May I delete X?" |

## üî¥ SAFEGUARDS (non-negotiable)

These rules are NOT negotiable:

- ‚è±Ô∏è **MAX 30 min autonomous** - Then STOP + ask user
- üóëÔ∏è **NO DELETE** without explicit user confirmation ("May I delete X?")
- üì§ **NO GIT PUSH** without user confirmation
- üîê **NO Secrets** in code (API Keys, Passwords, Tokens)
- üìã **Git commit every 5-10 min** via `pulse_checkpoint`

## üî¥ LOOP DETECTION

On EVERY `pulse_doctor` call, these are automatically checked:
- Fix-Chain (multiple "fix" commits)
- Revert-Pattern (A‚ÜîB)
- File-Churn (same file 5+ times)
- Pendulum (similar commits)

**On loop signal:**
```
1. IMMEDIATE STOP
2. No further changes
3. Call pulse_escalate
4. Inform user
```

## On Problems

After 2-3 failed attempts:

1. **STOP** - No further changes
2. **Call `pulse_escalate`** with:
   - Problem description
   - What you tried
   - Error message
3. **WAIT** for user instruction

## After Success (IMPORTANT!)

When you successfully solve a non-trivial problem:

1. **Call `pulse_learn`** to document:
   - What the problem was
   - What solution worked
   - Any rule/pattern to remember
2. This builds institutional knowledge for future sessions

## MCP Tools - WHEN TO CALL

| Tool | Trigger (MANDATORY) |
|------|---------------------|
| `pulse_status` | **FIRST action** of every response |
| `pulse_doctor` | **AFTER** any file edit/create/delete |
| `pulse_checkpoint` | **WHEN** >10 min since last checkpoint |
| `pulse_run` | **WHEN** user gives multi-step task (>3 steps) |
| `pulse_escalate` | **WHEN** 2-3 failed attempts OR error you don't understand |
| `pulse_correct` | **WHEN** user says "wrong", "not what I meant", "stop" |
| `pulse_review` | **BEFORE** saying "done", creating PR, or merging |
| `pulse_learn` | **AFTER** solving a non-trivial problem (document what worked) |
| `pulse_reset` | **WHEN** `pulse_doctor` shows loop signal |

## Example Flow

```
User: "Add login button"

Agent:
1. pulse_status          ‚Üí "OK, 8 min since checkpoint"
2. [Implements code]
3. pulse_doctor          ‚Üí "OK, no findings"
4. Responds with code + recommendation

User: "Test it"

Agent:
1. pulse_status          ‚Üí "‚ö†Ô∏è 14 min since checkpoint"
2. "Checkpoint recommended. Should I run pulse_checkpoint?"
3. [After confirmation] pulse_checkpoint
4. [Runs tests]
```

## IMPORTANT

- Call the tools ACTIVELY, not only when user asks
- When uncertain: STOP and ASK
- The safeguards ALWAYS apply, even if user argues against them
- **ALWAYS update CHANGELOG.md** after significant changes (features, fixes, changes)