# Oracle Research Report

**Date:** 1/2/2026, 10:48:34 PM
**Duration:** 181.0s
**Iterations:** 16

---

## Research Query

hey, based on my repository, generate some high quality Cursor rules that I should absolutely set up. Kind of like this : 
.cursor/rules/
├── always/
│   ├── code-style.mdc
│   └── security.mdc
├── backend/
│   ├── api-patterns.mdc
│   └── database.mdc
├── frontend/
│   ├── components.mdc
│   └── state-management.mdc
└── testing/
    └── test-patterns.mdc

[Pre-selected sources to focus on:
Codebase: TCDynamics (https://github.com/lawmight/TCDynamics)]

---

## Research Report

# TCDynamics Cursor Rules Configuration

Based on comprehensive analysis of your repository's architecture, patterns, and conventions, here's a complete set of high-quality Cursor rules tailored specifically to your project's tech stack and established patterns.

## Recommended Directory Structure

```
.cursor/rules/
├── always/
│   ├── code-style.mdc
│   ├── security.mdc
│   └── accessibility.mdc
├── backend/
│   ├── api-patterns.mdc
│   ├── middleware.mdc
│   └── validation.mdc
├── frontend/
│   ├── components.mdc
│   ├── hooks.mdc
│   └── state-management.mdc
├── api/
│   └── serverless.mdc
└── testing/
    ├── unit-tests.mdc
    └── e2e-tests.mdc
```

---

## Always Rules (Apply Globally)

### `.cursor/rules/always/code-style.mdc`

```markdown
---
description: Code style and formatting standards for TCDynamics
globs: ["**/*.{ts,tsx,js,jsx}"]
alwaysApply: true
---

# Code Style Standards

## TypeScript Strict Mode
- **Never use `any` type** - Use proper typing or `unknown` with type guards
- Define explicit interfaces for all Props and State
- Use `type` for unions/primitives, `interface` for object shapes

## Import Organization
Order imports following this pattern [Source 12]:
1. Built-in modules (node:*)
2. External packages (@tanstack, react, etc.)
3. Internal modules (@/)
4. Parent/sibling imports
5. Index imports

```typescript
// ✅ Correct import order
import { useState } from 'react'

import { QueryClient } from '@tanstack/react-query'

import { Button } from '@/components/ui/button'
import { cn } from '@/lib/utils'

import { localHelper } from './helpers'
```

## Naming Conventions
- **Components**: PascalCase with `.tsx` extension
- **Hooks**: camelCase prefixed with `use` (e.g., `useFormSubmit`)
- **Utilities**: camelCase in dedicated `/utils` or `/lib` folders
- **Types/Interfaces**: PascalCase, Props suffix for component props

## Console Usage
- ❌ Never use `console.log` in production code
- ✅ Use `console.warn` or `console.error` only
- ✅ Use the project's `logger` utility from `@/utils/logger` [Source 7]

## Code Documentation
- Add JSDoc comments for public functions and complex logic
- Include `@example` blocks for reusable hooks and utilities [Source 4]
```

### `.cursor/rules/always/security.mdc`

```markdown
---
description: Security standards and practices
globs: ["**/*.{ts,tsx,js,jsx}"]
alwaysApply: true
---

# Security Standards

## Input Sanitization
Always sanitize user inputs using DOMPurify [Source 3]:

```javascript
const DOMPurify = require('isomorphic-dompurify')

const sanitizeString = (str) => {
  if (typeof str !== 'string') return str
  return DOMPurify.sanitize(str)
}
```

## Authentication
- Use Supabase JWT verification for protected routes [Source 14]
- Always validate `Authorization: Bearer <token>` header format
- Return standardized error responses for auth failures

```javascript
if (!authHeader || !authHeader.startsWith('Bearer ')) {
  return { userId: null, error: 'Missing or invalid Authorization header' }
}
```

## API Security Headers
Apply Helmet configuration with strict CSP [Source 3]:
- `defaultSrc: ["'self'"]`
- `frameSrc: ["'none'"]`
- `objectSrc: ["'none'"]`
- Enable HSTS with preload

## Rate Limiting
- Apply rate limiting to all form submissions
- Default: 5 requests per 15 minutes per IP
- Use environment variables for configuration

## Sensitive Data
- Never log request bodies containing passwords or tokens
- Use environment variables for all secrets
- Reference `.env.example` for required variables [Source 1]
```

### `.cursor/rules/always/accessibility.mdc`

```markdown
---
description: WCAG 2.1 AA accessibility requirements
globs: ["**/*.tsx"]
alwaysApply: true
---

# Accessibility Standards (WCAG 2.1 AA)

## Required Attributes [Source 12]
- All `<img>` elements must have `alt` text
- All interactive elements must be keyboard accessible
- All form inputs must have associated labels

```tsx
// ✅ Correct
<label htmlFor="email">Email</label>
<input id="email" name="email" type="email" />

// ❌ Incorrect
<input placeholder="Email" />
```

## Interactive Elements
- `onClick` handlers require `onKeyDown` equivalents
- Interactive elements must have `tabIndex` when not natively focusable
- Use semantic HTML elements (`<button>`, `<a>`) over `<div>`

## Focus Management
- Visible focus indicators required (`:focus-visible`)
- Autofocus sparingly and only on non-DOM elements when needed
- Modal/dialog components must trap focus

## Component Library
When using ShadCN/Radix components:
- Leverage built-in accessibility features
- Don't override `role` or `aria-*` attributes unless necessary
- Test with keyboard navigation
```

---

## Backend Rules

### `.cursor/rules/backend/api-patterns.mdc`

```markdown
---
description: Express API route patterns and conventions
globs: ["apps/backend/**/*.{ts,js}"]
---

# API Route Patterns

## Error Class Hierarchy [Source 5]
Use custom error classes for consistent error handling:

```typescript
class ValidationError extends Error {
  constructor(message: string, field?: string) {
    super(message)
    this.name = 'ValidationError'
    this.statusCode = 400
    this.field = field
  }
}

// Available error classes:
// - ValidationError (400)
// - AuthenticationError (401)
// - AuthorizationError (403)
// - NotFoundError (404)
// - ConflictError (409)
// - RateLimitError (429)
```

## Async Handler Pattern
Wrap all async route handlers [Source 5]:

```typescript
const asyncHandler = (fn) => (req, res, next) => {
  Promise.resolve(fn(req, res, next)).catch(next)
}

// Usage
router.post('/contact', asyncHandler(async (req, res) => {
  // async logic here
}))
```

## Response Format
Standardize all API responses:

```typescript
// Success
{ success: true, message: "Operation completed", data: {...} }

// Error
{ success: false, message: "Error description", errors: [...] }
```

## Request Tracing
Include request ID in all logs [Source 5]:

```typescript
logError(error, {
  url: req.url,
  method: req.method,
  requestId: req.headers['x-request-id'],
  ip: req.ip
})
```
```

### `.cursor/rules/backend/validation.mdc`

```markdown
---
description: Input validation patterns using Joi
globs: ["apps/backend/**/*.{ts,js}"]
---

# Validation Patterns

## Joi Schema Structure [Source 6]
Use reusable validation helpers:

```javascript
const { commonFields } = require('./validationHelpers')

const contactSchema = Joi.object({
  name: commonFields.fullName(),
  email: commonFields.email(),
  phone: commonFields.phone(),
  company: commonFields.company(false), // optional
  message: commonFields.message(),
})
```

## Validation Middleware
Apply validation as middleware [Source 6]:

```javascript
const validateData = (schema) => (req, res, next) => {
  const { error, value } = schema.validate(req.body, {
    abortEarly: false,
    stripUnknown: true,
  })

  if (error) {
    const errorMessages = error.details.map(d => d.message)
    return res.status(400).json({
      success: false,
      message: 'Données invalides',
      errors: errorMessages,
    })
  }

  req.body = value // Use sanitized data
  next()
}
```

## Database Error Handling [Source 5]
Map PostgreSQL error codes to appropriate responses:

| Code | Type | HTTP Status |
|------|------|-------------|
| 23505 | Unique constraint | 409 Conflict |
| 23503 | Foreign key | 404 Not Found |
| 23502 | Not null | 400 Validation |
```

---

## Frontend Rules

### `.cursor/rules/frontend/components.mdc`

```markdown
---
description: React component patterns and conventions
globs: ["apps/frontend/src/components/**/*.tsx"]
---

# Component Patterns

## Interface Definitions [Source 4]
Define Props and State interfaces explicitly:

```tsx
interface Props {
  children: ReactNode
  fallback?: ReactNode
  onError?: (error: Error, errorInfo: ErrorInfo) => void
  onReset?: () => void
}

interface State {
  hasError: boolean
  error?: Error
}
```

## forwardRef Pattern [Source 4]
UI components must use forwardRef with displayName:

```tsx
const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn('rounded-lg border bg-card', className)}
    {...props}
  />
))
Card.displayName = 'Card'
```

## Class Merging
Always use `cn()` utility for conditional classes [Source 4]:

```tsx
import { cn } from '@/lib/utils'

<div className={cn(
  'base-classes',
  isActive && 'active-classes',
  className
)} />
```

## Context Pattern [Source 4]
Create context with custom hook for type safety:

```tsx
const ThemeContext = createContext<ThemeContextType | undefined>(undefined)

export const useTheme = () => {
  const context = useContext(ThemeContext)
  if (!context) {
    throw new Error('useTheme must be used within ThemeProvider')
  }
  return context
}
```

## Component Documentation
Include JSDoc with examples for reusable components [Source 4]:

```tsx
/**
 * ThemeProvider for managing light/dark/system modes
 * 
 * @example
 * ```tsx
 * <ThemeProvider>
 *   <App />
 * </ThemeProvider>
 * ```
 */
```
```

### `.cursor/rules/frontend/hooks.mdc`

```markdown
---
description: Custom React hooks patterns
globs: ["apps/frontend/src/hooks/**/*.{ts,tsx}"]
---

# Custom Hooks Patterns

## Hook Structure [Source 7]
Follow this structure for custom hooks:

```typescript
interface UseFormSubmitConfig {
  primaryEndpoint: string
  fallbackEndpoint: string
  enableFallback?: boolean
  errorMessage?: string
}

interface UseFormSubmitReturn<T> {
  submitForm: (data: T) => Promise<ApiResponse>
  isSubmitting: boolean
  response: ApiResponse | null
  clearResponse: () => void
  hasErrors: boolean
  isSuccess: boolean
}

export const useFormSubmit = <T>(
  config: UseFormSubmitConfig
): UseFormSubmitReturn<T> => {
  // implementation
}
```

## Primary/Fallback Pattern [Source 7]
Implement endpoint fallback for resilience:

```typescript
const performRequest = async () => {
  try {
    return await apiRequest(primaryEndpoint, options)
  } catch (primaryError) {
    if (enableFallback && shouldFallback(primaryError)) {
      return await apiRequest(fallbackEndpoint, options)
    }
    throw primaryError
  }
}
```

## State Management
- Return both raw state and derived booleans
- Provide clear reset/clear functions
- Use generics for type-safe data handling

## Analytics Integration
Track form submissions with Vercel Analytics [Source 7]:

```typescript
track('form_submitted', {
  endpoint: primaryEndpoint,
  timestamp: new Date().toISOString(),
})
```
```

---

## Testing Rules

### `.cursor/rules/testing/unit-tests.mdc`

```markdown
---
description: Unit and component testing patterns
globs: ["**/*.test.{ts,tsx}", "**/__tests__/**"]
---

# Unit Testing Patterns

## Test Structure [Source 8]
Use descriptive describe/it blocks:

```typescript
describe('Contact Component', () => {
  it('should render contact form', () => {
    render(<Contact />)
    expect(screen.getByText(/Contactez-nous/i)).toBeInTheDocument()
  })

  it('should validate required fields', async () => {
    render(<Contact />)
    fireEvent.click(screen.getByText(/Envoyer/i))
    
    await waitFor(() => {
      expect(emailInput.validity.valid).toBe(false)
    })
  })
})
```

## React Query Wrapper [Source 8]
Wrap components using React Query:

```typescript
const queryClient = new QueryClient({
  defaultOptions: {
    queries: { retry: false },
    mutations: { retry: false },
  },
})

const Wrapper = ({ children }) => (
  <QueryClientProvider client={queryClient}>
    {children}
  </QueryClientProvider>
)
```

## Multiple Elements
Use `getAllBy*` for elements appearing multiple times [Source 8]:

```typescript
expect(screen.getAllByText(/Email/i).length).toBeGreaterThan(0)
```

## Mocking Dependencies [Source 5]
Mock before imports:

```javascript
jest.mock('../../config/email', () => ({
  createTransporter: jest.fn(),
  emailTemplates: { demo: jest.fn() },
}))

// Import AFTER mocks
const { createTransporter } = require('../../config/email')
```
```

### `.cursor/rules/testing/e2e-tests.mdc`

```markdown
---
description: Playwright E2E testing patterns
globs: ["tests/e2e/**/*.spec.ts"]
---

# E2E Testing Patterns

## Test Structure [Source 11]

```typescript
test.describe('Contact Form Flow', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/')
  })

  test('should complete contact form successfully', async ({ page }) => {
    await page.click('text=Contact')
    await page.fill('input[name="name"]', 'John Doe')
    await page.fill('input[name="email"]', 'john@example.com')
    await page.click('button:has-text("Envoyer")')
    
    await expect(page.locator('text=Message envoyé')).toBeVisible()
  })
})
```

## API Mocking
Mock failed requests for error handling tests [Source 11]:

```typescript
test('should handle network errors gracefully', async ({ page }) => {
  await page.route('**/api/contact', route => route.abort())
  
  // ... fill form and submit
  
  await expect(page.locator("text=Erreur")).toBeVisible()
})
```

## Mobile Responsiveness [Source 11]

```typescript
test('should be responsive on mobile', async ({ page }) => {
  await page.setViewportSize({ width: 375, height: 667 })
  
  const mobileMenu = page.locator('button[aria-label*="menu"]')
  await mobileMenu.click()
  
  await expect(page.locator('text=Accueil')).toBeVisible()
})
```

## Selectors Priority
1. Accessible names: `text=`, `role=`
2. Test IDs: `data-testid`
3. CSS selectors (last resort)
```

---

## API Serverless Rules

### `.cursor/rules/api/serverless.mdc`

```markdown
---
description: Vercel serverless function patterns
globs: ["api/**/*.js",

---

## Sources & Citations

### Source 1

- **Tool:** get_github_tree
- **Source ID:** 1
- **Summary:** {
  "tree": "\ud83d\udcc1 .claude\n  \ud83d\udcc4 settings.local.json\n\ud83d\udcc1 .cursor\n  \ud83d\udcc1 plans\n    \ud83d\udcc4 stripe_to_polar_migration_7c5f3ab7.plan.md\n  \ud83d\udcc1 rules\n    \ud83d\udcc4 nia-oracle.mdc\n\ud83d\udcc4 .cursorrules\n\ud83d\udcc4 .env.example\n\ud83d\udcc4 .eslintignore\n\ud83d\udcc4 .eslintrc.js\n\ud83d\udcc4 .gitattributes\n\ud83d\udcc1 .github\n  \ud83d\udcc1 actions\n    \ud83d\udcc1 install-dependencies\n      \ud83d\udcc4 action.yml\n    \ud83d\udcc
- **Arguments:** {
  "project_id": "lawmight/TCDynamics"
}

### Source 2

- **Tool:** read_source_content
- **Source ID:** 2
- **Summary:** {
  "source": "lawmight/TCDynamics:.cursorrules",
  "content": "# Cursor Rules for TCDynamics Project\n# This file contains project-specific rules and startup configurations\n\n# NIA MCP Integration\n# The NIA MCP server should be running for optimal AI assistance\n# Auto-start options:\n# 1. Run: .\\setup-auto-start.ps1 (Windows login auto-start)\n# 2. Use: .\\start-mcp-silent.bat (silent background start)\n# 3. Add: cursor-mcp-config.json to .vscode/tasks.json (Cursor auto-start)\n\n# Project 
- **Arguments:** {
  "source": "lawmight/TCDynamics:.cursorrules"
}

### Source 3

- **Tool:** read_source_content
- **Source ID:** 3
- **Summary:** {
  "source": "lawmight/TCDynamics:apps/backend/src/middleware/security.js",
  "content": "const rateLimit = require('express-rate-limit')\nconst helmet = require('helmet')\nconst DOMPurify = require('isomorphic-dompurify')\nconst { logger } = require('../utils/logger')\n\n// Rate limiting pour les formulaires\nconst formRateLimit = rateLimit({\n  windowMs: parseInt(process.env.RATE_LIMIT_WINDOW_MS) || 15 * 60 * 1000, // 15 minutes\n  max: parseInt(process.env.RATE_LIMIT_MAX_REQUESTS) || 5, // 5
- **Arguments:** {
  "source": "lawmight/TCDynamics:apps/backend/src/middleware/security.js"
}

### Source 4

- **Tool:** query
- **Source ID:** 4
- **Summary:** {
  "content": "Query='React component patterns TypeScript props interface state management hooks'. Repo results=5 (projects=1). Doc results=0 (sources=0).",
  "sources": [
    {
      "content": "lawmight/TCDynamics/apps/frontend/src/components/ErrorBoundary.tsx import React, { Component, ErrorInfo, ReactNode } from 'react' import { Button } from '@/components/ui/button' import { AlertTriangle, RefreshCw } from 'lucide-react' interface Props { children: ReactNode fallback?: ReactNode onError?: 
- **Arguments:** {
  "query": "React component patterns TypeScript props interface state management hooks",
  "repositories": [
    "lawmight/TCDynamics"
  ],
  "search_mode": "repositories"
}

### Source 5

- **Tool:** query
- **Source ID:** 5
- **Summary:** {
  "content": "Query='API route handler express middleware validation error handling request response'. Repo results=5 (projects=1). Doc results=0 (sources=0).",
  "sources": [
    {
      "content": "lawmight/TCDynamics/apps/backend/src/middleware/errorHandler.js const { logError, logger } = require('../utils/logger') // Error types class ValidationError extends Error { constructor(message, field) { super(message) this.name = 'ValidationError' this.field = field this.statusCode = 400 } } class
- **Arguments:** {
  "query": "API route handler express middleware validation error handling request response",
  "repositories": [
    "lawmight/TCDynamics"
  ],
  "search_mode": "repositories"
}

### Source 6

- **Tool:** read_source_content
- **Source ID:** 6
- **Summary:** {
  "source": "lawmight/TCDynamics:apps/backend/src/utils/validation.js",
  "content": "const Joi = require('joi')\nconst { commonFields } = require('./validationHelpers')\n\n// Sch\u00e9ma de validation pour le formulaire de contact\n// Uses reusable validation helpers for consistency\nconst contactSchema = Joi.object({\n  name: commonFields.fullName(),\n  email: commonFields.email(),\n  phone: commonFields.phone(),\n  company: commonFields.company(false), // optional\n  message: commonFields.m
- **Arguments:** {
  "source": "lawmight/TCDynamics:apps/backend/src/utils/validation.js"
}

### Source 7

- **Tool:** read_source_content
- **Source ID:** 7
- **Summary:** {
  "source": "lawmight/TCDynamics:apps/frontend/src/hooks/useFormSubmit.ts",
  "content": "import { track } from '@vercel/analytics'\nimport { useState } from 'react'\n\nimport type { ApiResponse } from '@/utils/apiConfig'\nimport { logger } from '@/utils/logger'\n\n/**\n * Configuration for form submission endpoints\n */\ninterface FormSubmitConfig {\n  /** Primary endpoint (typically Azure Functions) */\n  primaryEndpoint: string\n  /** Fallback endpoint (typically Node.js backend) */\n  fall
- **Arguments:** {
  "source": "lawmight/TCDynamics:apps/frontend/src/hooks/useFormSubmit.ts"
}

### Source 8

- **Tool:** read_source_content
- **Source ID:** 8
- **Summary:** {
  "source": "lawmight/TCDynamics:apps/frontend/src/components/__tests__/Contact.test.tsx",
  "content": "import { QueryClient, QueryClientProvider } from '@tanstack/react-query'\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\n\nimport Contact from '../Contact'\n\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: { retry: false },\n    mutations: { retry: false },\n  },\n})\n\nconst ContactWrapper = ({ children }: { children: React.ReactNode 
- **Arguments:** {
  "source": "lawmight/TCDynamics:apps/frontend/src/components/__tests__/Contact.test.tsx"
}

### Source 9

- **Tool:** read_source_content
- **Source ID:** 9
- **Summary:** {
  "source": "lawmight/TCDynamics:apps/frontend/src/lib/supabaseClient.ts",
  "content": "import { createClient, type SupabaseClient } from '@supabase/supabase-js'\n\ntype ClientOrNull = SupabaseClient | null\n\nlet cached: ClientOrNull = null\n\nconst getEnv = (key: string) => import.meta.env[key]\n\nexport const getSupabaseClient = (): SupabaseClient => {\n  if (cached) return cached\n\n  const supabaseUrl = getEnv('VITE_SUPABASE_URL')\n  const supabaseAnonKey = getEnv('VITE_SUPABASE_ANON_KEY
- **Arguments:** {
  "source": "lawmight/TCDynamics:apps/frontend/src/lib/supabaseClient.ts"
}

### Source 10

- **Tool:** read_source_content
- **Source ID:** 10
- **Summary:** {
  "source": "lawmight/TCDynamics:apps/frontend/src/utils/apiConfig.ts",
  "content": "// API configuration for Vercel serverless functions\n// All endpoints use Vercel's serverless API routes\n\nexport const API_ENDPOINTS = {\n  // All endpoints now use Vercel serverless functions (relative URLs)\n  contact: `/api/forms`,\n  demo: `/api/forms`,\n  health: `/api/analytics?health=true`,\n  chat: `/api/chat`,\n  vision: `/api/vision`,\n  paymentIntent: `/api/payments?action=payment-intent`,\n  su
- **Arguments:** {
  "source": "lawmight/TCDynamics:apps/frontend/src/utils/apiConfig.ts"
}

### Source 11

- **Tool:** read_source_content
- **Source ID:** 11
- **Summary:** {
  "source": "lawmight/TCDynamics:tests/e2e/contact-flow.spec.ts",
  "content": "import { expect, test } from '@playwright/test'\n\ntest.describe('Contact Form Flow', () => {\n  test.beforeEach(async ({ page }) => {\n    await page.goto('/')\n  })\n\n  test('should complete contact form successfully', async ({ page }) => {\n    // Navigate to contact section\n    await page.click('text=Contact')\n\n    // Wait for form to be visible\n    await expect(page.locator('input[name=\"name\"]')).toBeVi
- **Arguments:** {
  "source": "lawmight/TCDynamics:tests/e2e/contact-flow.spec.ts"
}

### Source 12

- **Tool:** read_source_content
- **Source ID:** 12
- **Summary:** {
  "source": "lawmight/TCDynamics:apps/frontend/eslint.config.js",
  "content": "import js from '@eslint/js'\nimport typescript from '@typescript-eslint/eslint-plugin'\nimport tsParser from '@typescript-eslint/parser'\nimport prettier from 'eslint-config-prettier'\nimport importPlugin from 'eslint-plugin-import'\nimport jsxA11y from 'eslint-plugin-jsx-a11y'\nimport reactHooks from 'eslint-plugin-react-hooks'\nimport tailwindcss from 'eslint-plugin-tailwindcss'\nimport globals from 'globals'\n\n
- **Arguments:** {
  "source": "lawmight/TCDynamics:apps/frontend/eslint.config.js"
}

### Source 13

- **Tool:** read_source_content
- **Source ID:** 13
- **Summary:** {
  "source": "lawmight/TCDynamics:apps/frontend/tailwind.config.ts",
  "content": "import type { Config } from 'tailwindcss'\nimport tailwindcssAnimate from 'tailwindcss-animate'\n\nexport default {\n  darkMode: ['class'],\n  content: [\n    './pages/**/*.{ts,tsx}',\n    './components/**/*.{ts,tsx}',\n    './app/**/*.{ts,tsx}',\n    './src/**/*.{ts,tsx}',\n  ],\n  prefix: '',\n  theme: {\n    container: {\n      center: true,\n      padding: '2rem',\n      screens: {\n        '2xl': '1400px',\n
- **Arguments:** {
  "source": "lawmight/TCDynamics:apps/frontend/tailwind.config.ts"
}

### Source 14

- **Tool:** read_source_content
- **Source ID:** 14
- **Summary:** {
  "source": "lawmight/TCDynamics:api/_lib/auth.js",
  "content": "/**\n * Supabase Auth Verification Utility\n * Verifies JWT tokens in Vercel serverless functions\n */\n\nimport { getSupabaseClient } from './supabase.js'\n\n/**\n * Verify Supabase auth token and return user ID\n * @param {string} authHeader - Authorization header (Bearer token)\n * @returns {Promise<{userId: string | null, error: string | null}>}\n */\nexport async function verifySupabaseAuth(authHeader) {\n  if (!authHeader 
- **Arguments:** {
  "source": "lawmight/TCDynamics:api/_lib/auth.js"
}

### Source 15

- **Tool:** think
- **Source ID:** 15
- **Summary:** Reflection recorded. Continue with next action.
- **Arguments:** {
  "reflection": "## Research Synthesis\n\n**Tech Stack Identified:**\n- Frontend: React 18 + TypeScript + Vite + Tailwind CSS + ShadCN UI (Radix primitives)\n- Backend: Node.js/Express + TypeScript\n- Database: Supabase (PostgreSQL)\n- API: Vercel serverless functions + Express backend\n- Payments: Polar (migrated from Stripe)\n- AI: Vertex AI integration\n- Testing: Vitest + React Testing Library + Playwright E2E\n- CI/CD: GitHub Actions + Vercel\n\n**Security Patterns Found:**\n- Helmet security headers with strict CSP\n- Rate limiting (express-rate-limit)\n- DOMPurify for XSS prevention\n- CSRF protection middleware\n- IP validation and bot detection\n- Supabase JWT auth verification\n\n**Code Style Conventions:**\n- TypeScript strict mode with `@typescript-eslint/no-explicit-any: error`\n- Accessibility-first (jsx-a11y WCAG 2.1 AA)\n- Import ordering (external → internal → parent/sibling)\n- Tailwind class ordering\n- React hooks rules enforced\n- No console.log (only warn/error allowed)\n\n**Component Patterns:**\n- TypeScript interfaces for Props/State\n- React.forwardRef with displayName\n- Context API with custom hooks (useAccordion, useTheme)\n- cn() utility for class merging\n- Comprehensive JSDoc documentation\n\n**API Patterns:**\n- Custom error classes hierarchy (ValidationError, AuthenticationError, etc.)\n- asyncHandler wrapper for error propagation\n- Joi validation schemas with reusable fields\n- Primary/fallback endpoint pattern\n- Request ID tracing\n\n**Testing Patterns:**\n- QueryClient wrapper for React Query\n- describe/it structure\n- getAllBy queries for multiple elements\n- API mocking with route interception\n- Mobile responsiveness testing\n\n**Confidence: HIGH** - I have all the information needed to create comprehensive, tailored Cursor rules."
}

---

## Tool Calls

### 1. get_github_tree

- **Timestamp:** 2026-01-02T22:45:39.242560+00:00
- **Arguments:**
```json
{
  "project_id": "lawmight/TCDynamics"
}
```

### 2. read_source_content

- **Timestamp:** 2026-01-02T22:45:48.110958+00:00
- **Arguments:**
```json
{
  "source": "lawmight/TCDynamics:.cursorrules"
}
```

### 3. read_source_content

- **Timestamp:** 2026-01-02T22:45:55.254870+00:00
- **Arguments:**
```json
{
  "source": "lawmight/TCDynamics:apps/backend/src/middleware/security.js"
}
```

### 4. query

- **Timestamp:** 2026-01-02T22:46:02.700248+00:00
- **Arguments:**
```json
{
  "query": "React component patterns TypeScript props interface state management hooks",
  "repositories": [
    "lawmight/TCDynamics"
  ],
  "search_mode": "repositories"
}
```

### 5. query

- **Timestamp:** 2026-01-02T22:46:11.054165+00:00
- **Arguments:**
```json
{
  "query": "API route handler express middleware validation error handling request response",
  "repositories": [
    "lawmight/TCDynamics"
  ],
  "search_mode": "repositories"
}
```

### 6. read_source_content

- **Timestamp:** 2026-01-02T22:46:17.036322+00:00
- **Arguments:**
```json
{
  "source": "lawmight/TCDynamics:apps/backend/src/utils/validation.js"
}
```

### 7. read_source_content

- **Timestamp:** 2026-01-02T22:46:22.719807+00:00
- **Arguments:**
```json
{
  "source": "lawmight/TCDynamics:apps/frontend/src/hooks/useFormSubmit.ts"
}
```

### 8. read_source_content

- **Timestamp:** 2026-01-02T22:46:27.642068+00:00
- **Arguments:**
```json
{
  "source": "lawmight/TCDynamics:apps/frontend/src/components/__tests__/Contact.test.tsx"
}
```

### 9. read_source_content

- **Timestamp:** 2026-01-02T22:46:33.433472+00:00
- **Arguments:**
```json
{
  "source": "lawmight/TCDynamics:apps/frontend/src/lib/supabaseClient.ts"
}
```

### 10. read_source_content

- **Timestamp:** 2026-01-02T22:46:38.067004+00:00
- **Arguments:**
```json
{
  "source": "lawmight/TCDynamics:apps/frontend/src/utils/apiConfig.ts"
}
```

### 11. read_source_content

- **Timestamp:** 2026-01-02T22:46:42.784187+00:00
- **Arguments:**
```json
{
  "source": "lawmight/TCDynamics:tests/e2e/contact-flow.spec.ts"
}
```

### 12. read_source_content

- **Timestamp:** 2026-01-02T22:46:46.995097+00:00
- **Arguments:**
```json
{
  "source": "lawmight/TCDynamics:apps/frontend/eslint.config.js"
}
```

### 13. read_source_content

- **Timestamp:** 2026-01-02T22:46:51.253008+00:00
- **Arguments:**
```json
{
  "source": "lawmight/TCDynamics:apps/frontend/tailwind.config.ts"
}
```

### 14. read_source_content

- **Timestamp:** 2026-01-02T22:46:56.566523+00:00
- **Arguments:**
```json
{
  "source": "lawmight/TCDynamics:api/_lib/auth.js"
}
```

### 15. think

- **Timestamp:** 2026-01-02T22:47:15.892416+00:00
- **Arguments:**
```json
{
  "reflection": "## Research Synthesis\n\n**Tech Stack Identified:**\n- Frontend: React 18 + TypeScript + Vite + Tailwind CSS + ShadCN UI (Radix primitives)\n- Backend: Node.js/Express + TypeScript\n- Database: Supabase (PostgreSQL)\n- API: Vercel serverless functions + Express backend\n- Payments: Polar (migrated from Stripe)\n- AI: Vertex AI integration\n- Testing: Vitest + React Testing Library + Playwright E2E\n- CI/CD: GitHub Actions + Vercel\n\n**Security Patterns Found:**\n- Helmet security headers with strict CSP\n- Rate limiting (express-rate-limit)\n- DOMPurify for XSS prevention\n- CSRF protection middleware\n- IP validation and bot detection\n- Supabase JWT auth verification\n\n**Code Style Conventions:**\n- TypeScript strict mode with `@typescript-eslint/no-explicit-any: error`\n- Accessibility-first (jsx-a11y WCAG 2.1 AA)\n- Import ordering (external → internal → parent/sibling)\n- Tailwind class ordering\n- React hooks rules enforced\n- No console.log (only warn/error allowed)\n\n**Component Patterns:**\n- TypeScript interfaces for Props/State\n- React.forwardRef with displayName\n- Context API with custom hooks (useAccordion, useTheme)\n- cn() utility for class merging\n- Comprehensive JSDoc documentation\n\n**API Patterns:**\n- Custom error classes hierarchy (ValidationError, AuthenticationError, etc.)\n- asyncHandler wrapper for error propagation\n- Joi validation schemas with reusable fields\n- Primary/fallback endpoint pattern\n- Request ID tracing\n\n**Testing Patterns:**\n- QueryClient wrapper for React Query\n- describe/it structure\n- getAllBy queries for multiple elements\n- API mocking with route interception\n- Mobile responsiveness testing\n\n**Confidence: HIGH** - I have all the information needed to create comprehensive, tailored Cursor rules."
}
```

---

## Research Notes

1. [Source 1] get_github_tree({"project_id": "lawmight/TCDynamics"}): {
  "tree": "\ud83d\udcc1 .claude\n  \ud83d\udcc4 settings.local.json\n\ud83d\udcc1 .cursor\n  \ud83d\udcc1 plans\n    \ud83d\udcc4 stripe_to_polar_migration_7c5f3ab7.plan.md\n  \ud83d\udcc1 rules\n    \ud83d\udcc4 nia-oracle.mdc\n\ud83d\udcc4 .cursorrules\n\ud83d\udcc4 .env.example\n\ud83d\udcc4 .eslintignore\n\ud83d\udcc4 .eslintrc.js\n\ud83d\udcc4 .gitattributes\n\ud83d\udcc1 .github\n  \ud83d\udcc1 actions\n    \ud83d\udcc1 install-dependencies\n      \ud83d\udcc4 action.yml\n    \ud83d\udcc1 setup-node-cache\n      \ud83d\udcc4 action.yml\n    \ud83d\udcc1 validate-api\n      \ud83d\udcc4 action.yml\n      \ud83d\udcc4 check-esm.js\n      \ud83d\udcc4 required-files.txt\n  \ud83d\udcc4 dependabot.yml\n  \ud83d\udcc4 dependency-review-config.yml\n  \ud83d\udcc1 workflows\n    \ud83d\udcc4 deploy-mvp.yml\n    \ud83d\udcc4 quality-gate.yml\n\ud83d\udcc4 .gitignore\n\ud83d\udcc1 .husky\n  \ud83d\udcc4 commit-msg\n  \ud83d\udcc4 pre-commit\n  \ud83d\udcc4 pre-push\n\ud83d\udcc4 .prettierignore\n\ud83d\udcc4 .prettierrc\n\ud83d\udcc4 .snyk\n\ud83d\udcc1 .vscode\n  \ud83d\udcc4 extensions.json\n  \ud83d\udcc4 launch.json\n  \ud83d\udcc4 settings.json\n  \ud83d\udcc4 tasks.json\n\ud83d\udcc4 README.md\n\ud83d\udcc1 api\n  \ud83d\udcc1 __tests__\n    \ud83d\udcc4 files-upload.test.js\n  \ud83d\udcc1 _lib\n    \ud83d\udcc4 api-key-auth.js\n    \ud83d\udcc4 auth.js\n    \ud83d\udcc4 cache.js\n    \ud83d\udcc4 email.js\n    \ud83d\udcc4 request-guards.js\n    \ud83d\udcc4 sentry.js\n    \ud83d\udcc4 supabase.js\n    \ud83d\udcc4 vertex.js\n  \ud83d\udcc4 analytics.js\n  \ud83d\udcc1 app\n    \ud83d\udcc4 api-keys.js\n  \ud83d\udcc4 chat.js\n  \ud83d\udcc4 files.js\n  \ud83d\udcc4 forms.js\n  \ud83d\udcc4 package-lock.json\n  \ud83d\udcc4 package.json\n  \ud83d\udcc4 payments.js\n  \ud83d\udcc1 polar\n    \ud83d\udcc4 checkout-session.js\n    \ud83d\udcc4 create-checkout-session.js\n    \ud83d\udcc4 webhook.js\n  \ud83d\udcc4 vertex.js\n  \ud83d\udcc4 vision.js\n\ud83d\udcc1 apps\n  \ud83d\udcc1 backend\n    \ud83d\udcc4 .eslintrc.js\n    \ud83d\udcc4 .gitignore\n    \ud83d\udcc4 Dockerfile\n    \ud83d\udcc4 ecosystem.config.js\n    \ud83d\udcc4 env.example\n    \ud83d\udcc4 healthcheck.js\n    \ud83d\udcc4 init.sql\n    \ud83d\udcc4 jest.config.js\n    \ud83d\udcc4 package-lock.json\n    \ud83d\udcc4 package.json\n    \ud83d\udcc1 src\n      \ud83d\udcc1 __tests__\n        \ud83d\udcc4 setup.js\n      \ud83d\udcc4 app.ts\n      \ud83d\udcc1 config\n        \ud83d\udcc4 database.ts\n        \ud83d\udcc4 email.js\n        \ud83d\udcc4 environment.ts\n        \ud83d\udcc4 middleware.ts\n      \ud83d\udcc1 middleware\n        \ud83d\udcc1 __tests__\n          \ud83d\udcc4 rateLimiter.test.js\n        \ud83d\udcc4 auth.js\n        \ud83d\udcc4 csrf.js\n        \ud83d\udcc4 errorHandler.js\n        \ud83d\udcc4 security.js\n      \ud83d\udcc1 routes\n        \ud83d\udcc1 __tests__\n          \ud83d\udcc4 contact.test.js\n          \ud83d\udcc4 demo.test.js\n          \ud83d\udcc4 monitoring.test.js\n        \ud83d\udcc4 contact.js\n        \ud83d\udcc4 demo.js\n        \ud83d\udcc4 feedback.js\n        \ud83d\udcc4 monitoring.js\n        \ud83d\udcc4 rum.js\n        \ud83d\udcc4 stripe.ts\n      \ud83d\udcc4 server.js\n      \ud83d\udcc4 server.ts\n      \ud83d\udcc1 services\n        \ud83d\udcc4 email.service.ts\n        \ud83d\udcc4 stripe.service.ts\n      \ud83d\udcc4 swagger.js\n      \ud83d\udcc1 types\n        \ud83d\udcc4 logger.d.ts\n        \ud83d\udcc4 routes.d.ts\n      \ud83d\udcc1 utils\n        \ud83d\udcc1 __tests__\n          \ud83d\udcc4 routeFactory.test.js\n          \ud83d\udcc4 validation.test.js\n          \ud83d\udcc4 validationHelpers.test.js\n        \ud83d\udcc4 db.js\n        \ud83d\udcc4 logger.d.ts\n        \ud83d\udcc4 logger.js\n        \ud83d\udcc4 routeFactory.js\n        \ud83d\udcc4 validation.js\n        \ud83d\udcc4 validationHelpers.js\n    \ud83d\udcc4 test-imports.js\n    \ud83d\udcc4 test-integration.js\n    \ud83d\udcc4 tsconfig.json\n  \ud83d\udcc1 frontend\n    \ud83d\udcc4 .env.example\n    \ud83d\udcc4 .gitignore\n    \ud83d\udcc1 .husky\n      \ud83d\udcc4 pre-commit\n    \ud83d\udcc4 .vercelignore\n    \ud83d\udcc1 api\n      \ud83d\udcc1 __tests__\n        \ud83d\udcc4 files-upload.test.js\n      \ud83d\udcc1 _lib\n        \ud83d\udcc4 api-key-auth.js\n        \ud83d\udcc4 auth.js\n        \ud83d\udcc4 cache.js\n        \ud83d\udcc4 email.js\n        \ud83d\udcc4 request-guards.js\n        \ud83d\udcc4 sentry.js\n        \ud83d\udcc4 supabase.js\n        \ud83d\udcc4 vertex.js\n      \ud83d\udcc4 analytics.js\n      \ud83d\udcc1 app\n        \ud83d\udcc4 api-keys.js\n      \ud83d\udcc4 chat.js\n      \ud83d\udcc4 contactform.js\n      \ud83d\udcc4 demoform.js\n      \ud83d\udcc4 files.js\n      \ud83d\udcc4 package-lock.json\n      \ud83d\udcc4 package.json\n      \ud83d\udcc4 payments.js\n      \ud83d\udcc1 polar\n        \ud83d\udcc4 checkout-session.js\n        \ud83d\udcc4 create-checkout-session.js\n        \ud83d\udcc4 webhook.js\n      \ud83d\udcc4 vertex.js\n      \ud83d\udcc4 vision.js\n    \ud83d\udcc4 eslint.config.js\n    \ud83d\udcc4 index.html\n    \ud83d\udcc4 lighthouserc.js\n    \ud83d\udcc4 package-lock.json\n    \ud83d\udcc4 package.json\n    \ud83d\udcc4 playwright.config.ts\n    \ud83d\udcc1 plugins\n      \ud83d\udcc4 vite-csp-hash-plugin.ts\n    \ud83d\udcc4 postcss.config.js\n    \ud83d\udcc1 public\n      \ud83d\udcc4 android-chrome-192x192.png\n      \ud83d\udcc4 android-chrome-512x512.png\n      \ud83d\udcc4 apple-touch-icon.png\n      \ud83d\udcc4 favicon-16x16.png\n      \ud83d\udcc4 favicon-32x32.png\n      \ud83d\udcc4 favicon.ico\n      \ud83d\udcc4 manifest.json\n      \ud83d\udcc4 placeholder.svg\n      \ud83d\udcc4 robots.txt\n      \ud83d\udcc1 rum\n        \ud83d\udcc1 v1\n          \ud83d\udcc4 rum.js\n      \ud83d\udcc1 scripts\n        \ud83d\udcc4 facebook-sdk.js\n        \ud83d\udcc4 theme-init.js\n      \ud83d\udcc4 sw.js\n    \ud83d\udcc1 scripts\n      \ud83d\udcc4 check-coep-resources.js\n      \ud83d\udcc4 compute-csp-hash.js\n    \ud83d\udcc4 setup-env-vars.sh\n    \ud83d\udcc1 src\n      \ud83d\udcc4 App.css\n      \ud83d\udcc4 App.tsx\n      \ud83d\udcc1 api\n        \ud83d\udcc1 __tests__\n          \ud83d\udcc4 azureServices.test.ts\n        \ud83d\udcc4 analytics.ts\n        \ud83d\udcc4 azureServices.ts\n        \ud83d\udcc4 files.ts\n        \ud83d\udcc4 metrics.ts\n        \ud83d\udcc4 vertex.ts\n      \ud83d\udcc1 assets\n        \ud83d\udcc4 hero-automation-video.mp4\n        \ud83d\udcc4 hero-automation.jpg\n        \ud83d\udcc4 hero-network.jpg\n      \ud83d\udcc1 components\n        \ud83d\udcc4 AIChatbot.tsx\n        \ud83d\udcc4 AIDemo.tsx\n        \ud83d\udcc4 Captcha.tsx\n        \ud83d\udcc4 Contact.tsx\n        \ud83d\udcc4 DocumentProcessor.tsx\n        \ud83d\udcc4 ErrorBoundary.tsx\n        \ud83d\udcc4 FAQ.tsx\n        \ud83d\udcc4 Features.tsx\n        \ud83d\udcc4 Footer.tsx\n        \ud83d\udcc4 Hero.tsx\n        \ud83d\udcc4 HowItWorks.tsx\n        \ud83d\udcc4 LazyAIChatbot.tsx\n        \ud83d\udcc4 LocalAdvantages.tsx\n        \ud83d\udcc4 OfflineIndicator.tsx\n        \ud83d\udcc4 OptimizedImage.tsx\n        \ud83d\udcc4 PerformanceMonitor.tsx\n        \ud83d\udcc4 PostSubmissionFeedback.tsx\n        \ud83d\udcc4 Pricing.tsx\n        \ud83d\udcc4 ScrollToTop.tsx\n        \ud83d\udcc4 SimpleNavigation.tsx\n        \ud83d\udcc4 SocialProof.tsx\n        \ud83d\udcc4 ThemeProvider.tsx\n        \ud83d\udcc1 __tests__\n          \ud83d\udcc4 AIChatbot.test.tsx\n          \ud83d\udcc4 AIDemo.test.tsx\n          \ud83d\udcc4 Contact.test.tsx\n          \ud83d\udcc4 DocumentProcessor.test.tsx\n          \ud83d\udcc4 ErrorBoundary.test.tsx\n          \ud83d\udcc4 FAQ.test.tsx\n          \ud83d\udcc4 Features.test.tsx\n          \ud83d\udcc4 Footer.test.tsx\n          \ud83d\udcc4 Hero.test.tsx\n          \ud83d\udcc4 HowItWorks.test.tsx\n          \ud83d\udcc4 LazyAIChatbot.test.tsx\n          \ud83d\udcc4 LocalAdvantages.test.tsx\n          \ud83d\udcc4 OfflineIndicator.test.tsx\n          \ud83d\udcc4 OptimizedImage.test.tsx\n          \ud83d\udcc4 PerformanceMonitor.test.tsx\n          \ud83d\udcc4 Pricing.test.tsx\n          \ud83d\udcc4 SimpleNavigation.test.tsx\n          \ud83d\udcc4 SocialProof.test.tsx\n        \ud83d\udcc1 app\n          \ud83d\udcc4 AppLayout.tsx\n        \ud83d\udcc1 ui\n          \ud83d\udcc1 __tests__\n            \ud83d\udcc4 animated-counter.test.tsx\n            \ud83d\udcc4 button.test.tsx\n          \ud83d\udcc4 alert.tsx\n          \ud83d\udcc4 animated-counter.tsx\n          \ud83d\udcc4 badge.tsx\n          \ud83d\udcc4 button.tsx\n          \ud83d\udcc4 card.tsx\n          \ud83d\udcc4 input.tsx\n          \ud83d\udcc4 label.tsx\n          \ud83d\udcc4 scroll-area.tsx\n          \ud83d\udcc4 separator.tsx\n          \ud83d\udcc4 sheet.tsx\n          \ud83d\udcc4 sonner.tsx\n          \ud83d\udcc4 tabs.tsx\n          \ud83d\udcc4 textarea.tsx\n          \ud83d\udcc4 toast.tsx\n          \ud83d\udcc4 toaster.tsx\n          \ud83d\udcc4 tooltip.tsx\n      \ud83d\udcc1 data\n        \ud83d\udcc4 productHighlights.ts\n      \ud83d\udcc1 hooks\n        \ud83d\udcc1 __tests__\n          \ud83d\udcc4 use-mobile.test.ts\n          \ud83d\udcc4 use-toast.test.ts\n          \ud83d\udcc4 useBodyScrollLock.test.ts\n          \ud83d\udcc4 useContactForm.test.ts\n          \ud83d\udcc4 useDemoForm.test.ts\n          \ud83d\udcc4 useFormSubmit.test.ts\n          \ud83d\udcc4 useIntersectionObserver.test.ts\n          \ud83d\udcc4 useThrottle.test.ts\n          \ud83d\udcc4 useToggle.test.ts\n        \ud83d\udcc4 use-mobile.tsx\n        \ud83d\udcc4 use-toast.ts\n        \ud83d\udcc4 useAuth.tsx\n        \ud83d\udcc4 useBodyScrollLock.ts\n        \ud83d\udcc4 useContactForm.ts\n        \ud83d\udcc4 useDemoForm.ts\n        \ud83d\udcc4 useFormSubmit.ts\n        \ud83d\udcc4 useIntersectionObserver.tsx\n        \ud83d\udcc4 useThrottle.ts\n        \ud83d\udcc4 useToggle.ts\n      \ud83d\udcc4 index.css\n      \ud83d\udcc1 lib\n        \ud83d\udcc4 supabaseClient.ts\n        \ud83d\udcc4 utils.ts\n      \ud83d\udcc4 main.tsx\n      \ud83d\udcc1 pages\n        \ud83d\udcc4 About.tsx\n        \ud83d\udcc4 Checkout.tsx\n        \ud83d\udcc4 CheckoutSuccess.tsx\n        \ud83d\udcc4 Contact.tsx\n        \ud83d\udcc4 Dashboard.tsx\n        \ud83d\udcc4 Demo.tsx\n        \ud83d\udcc4 Diagnostics.tsx\n        \ud83d\udcc4 Features.tsx\n        \ud83d\udcc4 GetStarted.tsx\n        \ud83d\udcc4 Index.tsx\n        \ud83d\udcc4 NotFound.tsx\n        \ud83d\udcc4 Pages.tsx\n        \ud83d\udcc4 Pricing.tsx\n        \ud83d\udcc4 Recommendations.tsx\n        \ud83d\udcc4 Security.tsx\n        \ud83d\udcc4 Settings.tsx\n        \ud83d\udcc1 __tests__\n          \ud83d\udcc4 About.test.tsx\n          \ud83d\udcc4 CheckoutSuccess.test.tsx\n          \ud83d\udcc4 Features.test.tsx\n          \ud83d\udcc4 Index.test.tsx\n          \ud83d\udcc4 NotFound.test.tsx\n        \ud83d\udcc1 app\n          \ud83d\udcc4 Analytics.tsx\n          \ud83d\udcc4 Chat.tsx\n          \ud83d\udcc4 Files.tsx\n          \ud83d\udcc1 __tests__\n            \ud83d\udcc4 Chat.test.tsx\n            \ud83d\udcc4 Files.test.tsx\n        \ud83d\udcc1 auth\n          \ud83d\udcc4 Login.tsx\n          \ud83d\udcc1 __tests__\n            \ud83d\udcc4 Login.test.tsx\n      \ud83d\udcc1 test\n        \ud83d\udcc1 mocks\n          \ud83d\udcc4 lucide-react.tsx\n          \ud83d\udcc4 styles.css\n        \ud83d\udcc4 setup.ts\n      \ud83d\udcc1 utils\n        \ud83d\udcc1 __tests__\n          \ud83d\udcc4 config.test.ts\n          \ud83d\udcc4 csrf.test.ts\n          \ud83d\udcc4 integration.test.ts\n          \ud83d\udcc4 logger.test.ts\n          \ud83d\udcc4 math.test.ts\n          \ud83d\udcc4 security.test.ts\n        \ud83d\udcc4 aiCache.ts\n        \ud83d\udcc4 analytics.ts\n        \ud83d\udcc4 apiConfig.ts\n        \ud83d\udcc4 config.ts\n        \ud83d\udcc4 csrf.ts\n        \ud83d\udcc4 isomorphic.ts\n        \ud83d\udcc4 logger.ts\n        \ud83d\udcc4 math.ts\n        \ud83d\udcc4 monitoring.tsx\n        \ud83d\udcc4 performance-optimized.ts\n        \ud83d\udcc4 performance.ts\n        \ud83d\udcc4 polar.ts\n        \ud83d\udcc4 security.ts\n        \ud83d\udcc4 stripe.ts\n        \ud83d\udcc4 swRegistration.ts\n      \ud83d\udcc4 vite-env.d.ts\n    \ud83d\udcc4 staticwebapp.config.json\n    \ud83d\udcc4 supabase-schema.sql\n    \ud83d\udcc4 tailwind.config.ts\n    \ud83d\udcc4 tsconfig.app.json\n    \ud83d\udcc4 tsconfig.e2e.json\n    \ud83d\udcc4 tsconfig.json\n    \ud83d\udcc4 tsconfig.node.json\n    \ud83d\udcc4 vercel.json\n    \ud83d\udcc4 vercel.json.backup\n    \ud83d\udcc4 vite.config.ts\n    \ud83d\udcc4 vitest.config.ts\n  \ud83d\udcc1 functions-archive\n    \ud83d\udcc1 functions\n      \ud83d\udcc4 SETUP.md\n      \ud83d\udcc4 check-dependencies.sh\n      \ud83d\udcc4 constraints.txt\n      \ud83d\udcc4 deploy-azure-functions.bat\n      \ud83d\udcc4 deploy-azure-functions.sh\n      \ud83d\udcc4 function_app.py\n      \ud83d\udcc4 host.json\n      \ud83d\udcc4 pytest.ini\n      \ud83d\udcc4 requirements-dev.txt\n      \ud83d\udcc4 requirements.txt\n      \ud83d\udcc1 services\n        \ud83d\udcc4 __init__.py\n        \ud83d\udcc4 client_manager.py\n        \ud83d\udcc4 helpers.py\n        \ud83d\udcc4 response_builder.py\n        \ud83d\udcc4 validators.py\n      \ud83d\udcc4 test_azure_functions.py\n      \ud83d\udcc4 test_curl_escape.bat\n    \ud83d\udcc4 workflow-python-functions.yml\n\ud83d\udcc4 commitlint.config.cjs\n\ud83d\udcc1 docker\n  \ud83d\udcc4 Dockerfile.frontend\n  \ud83d\udcc4 docker-compose.yml\n  \ud83d\udcc4 nginx.conf\n  \ud83d\udcc4 redis.conf\n\ud83d\udcc1 docs\n  \ud83d\udcc4 AGENTS.md\n  \ud83d\udcc4 AZURE_FUNCTIONS.md\n  \ud83d\udcc4 DEPLOYMENT.md\n  \ud83d\udcc4 GIT_STATUS.md\n  \ud83d\udcc4 SECURITY_HEADERS.md\n  \ud83d\udcc4 SUPABASE_FEEDBACK_TABLE.sql\n  \ud83d\udcc4 VERTEX_LOCATION_MIGRATION.md\n  \ud83d\udcc4 greptile-analysis.md\n  \ud83d\udcc4 nia-sources.md\n\ud83d\udcc4 eslint.config.js\n\ud83d\udcc4 greptile.json\n\ud83d\udcc4 package-lock.json\n\ud83d\udcc4 package.json\n\ud83d\udcc1 scripts\n  \ud83d\udcc4 deploy-vercel-frontend-only.ps1\n  \ud83d\udcc4 deploy-vercel.ps1\n  \ud83d\udcc4 migrate-stripe-to-polar.sql\n\ud83d\udcc4 supabase-schema-enhanced.sql\n\ud83d\udcc1 tests\n  \ud83d\udcc1 e2e\n    \ud83d\udcc4 contact-flow.spec.ts\n    \ud83d\udcc4 global-setup.ts\n    \ud83d\udcc4 global-teardown.ts\n    \ud83d\udcc4 navigation.spec.ts\n    \ud83d\udcc4 third-party-resources.spec.ts\n\ud83d\udcc1 tools\n  \ud83d\udcc1 configs\n    \ud83d\udcc4 commitlint.config.cjs\n    \ud83d\udcc4 components.json\n    \ud83d\udcc4 eslint.config.js\n  \ud83d\udcc1 scripts\n    \ud83d\udcc4 pre-push-checks.js\n    \ud83d\udcc4 setup-nginx-csp.sh\n\ud83d\udcc4 vercel.json\n\ud83d\udcc4 vercel.json.dev",
  "stats": {
    "total_files": 361,
    "total_directories": 77,
    "total_items": 438
  },
  "branch": "main",
  "truncated": false,
  "hint": null
}

2. [Source 2] read_source_content({"source": "lawmight/TCDynamics:.cursorrules"}): {
  "source": "lawmight/TCDynamics:.cursorrules",
  "content": "# Cursor Rules for TCDynamics Project\n# This file contains project-specific rules and startup configurations\n\n# NIA MCP Integration\n# The NIA MCP server should be running for optimal AI assistance\n# Auto-start options:\n# 1. Run: .\\setup-auto-start.ps1 (Windows login auto-start)\n# 2. Use: .\\start-mcp-silent.bat (silent background start)\n# 3. Add: cursor-mcp-config.json to .vscode/tasks.json (Cursor auto-start)\n\n# Project Structure\n- /src: React/TypeScript frontend\n- /backend: Node.js backend API\n- /TCDynamics: Python Azure Functions\n- /TCDynamics-Functions: Additional Azure Functions\n\n# Coding Standards\n- Use TypeScript for frontend components\n- Use Python for Azure Functions\n- Follow existing code patterns and naming conventions\n- Keep components modular and reusable\n\n# Development Workflow\n1. Start MCP server: .\\start-mcp-background.ps1\n2. Use AI assistance for code analysis and suggestions\n3. Test changes thoroughly before committing\n4. Follow existing commit message patterns\n\n# File Exclusions (for AI analysis)\n- Exclude: AzureFunctionsTools/, .venv/, node_modules/\n- Focus on: Source code, configurations, documentation\n",
  "language": "cursorrules",
  "truncated": false,
  "original_size": 1140
}

3. [Source 3] read_source_content({"source": "lawmight/TCDynamics:apps/backend/src/middleware/security.js"}): {
  "source": "lawmight/TCDynamics:apps/backend/src/middleware/security.js",
  "content": "const rateLimit = require('express-rate-limit')\nconst helmet = require('helmet')\nconst DOMPurify = require('isomorphic-dompurify')\nconst { logger } = require('../utils/logger')\n\n// Rate limiting pour les formulaires\nconst formRateLimit = rateLimit({\n  windowMs: parseInt(process.env.RATE_LIMIT_WINDOW_MS) || 15 * 60 * 1000, // 15 minutes\n  max: parseInt(process.env.RATE_LIMIT_MAX_REQUESTS) || 5, // 5 requ\u00eates par IP\n  message: {\n    success: false,\n    message: 'Trop de tentatives. Veuillez r\u00e9essayer dans 15 minutes.',\n  },\n  standardHeaders: true,\n  legacyHeaders: false,\n})\n\n// Configuration Helmet pour la s\u00e9curit\u00e9\nconst helmetConfig = helmet({\n  contentSecurityPolicy: {\n    directives: {\n      defaultSrc: [\"'self'\"],\n      styleSrc: [\"'self'\", \"'unsafe-inline'\", 'https://fonts.googleapis.com'],\n      scriptSrc: [\"'self'\"],\n      imgSrc: [\"'self'\", 'data:', 'https:'],\n      fontSrc: [\"'self'\", 'https://fonts.gstatic.com'],\n      connectSrc: [\"'self'\"],\n      frameSrc: [\"'none'\"],\n      objectSrc: [\"'none'\"],\n      baseUri: [\"'self'\"],\n      formAction: [\"'self'\"],\n    },\n  },\n  crossOriginEmbedderPolicy: false,\n  hsts: {\n    maxAge: 31536000,\n    includeSubDomains: true,\n    preload: true,\n  },\n  noSniff: true,\n  xssFilter: true,\n  referrerPolicy: { policy: 'strict-origin-when-cross-origin' },\n})\n\n// Middleware de validation IP\nconst validateIP = (req, res, next) => {\n  const clientIP = req.ip || req.connection.remoteAddress\n\n  // Block known malicious IPs (you can expand this list)\n  const blockedIPs = process.env.BLOCKED_IPS\n    ? process.env.BLOCKED_IPS.split(',')\n    : []\n\n  if (blockedIPs.includes(clientIP)) {\n    return res.status(403).json({\n      success: false,\n      message: 'Acc\u00e8s refus\u00e9',\n    })\n  }\n\n  // Log suspicious activity\n  if (req.headers['user-agent'] && req.headers['user-agent'].includes('bot')) {\n    // Log bot activity for monitoring\n    logger.security('Bot activity detected', {\n      ip: clientIP,\n      userAgent: req.headers['user-agent'],\n      path: req.path,\n      method: req.method\n    })\n  }\n\n  next()\n}\n\n// Additional security middleware for input sanitization\nconst sanitizeInput = (req, res, next) => {\n  // Sanitize string inputs using DOMPurify to prevent XSS attacks\n  const sanitizeString = str => {\n    if (typeof str !== 'string') return str\n    return DOMPurify.sanitize(str)\n  }\n\n  // Sanitize body parameters\n  if (req.body && typeof req.body === 'object') {\n    for (const key in req.body) {\n      if (typeof req.body[key] === 'string') {\n        req.body[key] = sanitizeString(req.body[key])\n      }\n    }\n  }\n\n  // Sanitize query parameters\n  if (req.query && typeof req.query === 'object') {\n    for (const key in req.query) {\n      if (typeof req.query[key] === 'string') {\n        req.query[key] = sanitizeString(req.query[key])\n      }\n    }\n  }\n\n  next()\n}\n\nmodule.exports = {\n  formRateLimit,\n  helmetConfig,\n  validateIP,\n  sanitizeInput,\n}\n",
  "language": "js",
  "truncated": false,
  "original_size": 2929
}

4. [Source 4] query({"query": "React component patterns TypeScript props interface state management hooks", "repositories": ["lawmight/TCDynamics"], "search_mode": "repositories"}): {
  "content": "Query='React component patterns TypeScript props interface state management hooks'. Repo results=5 (projects=1). Doc results=0 (sources=0).",
  "sources": [
    {
      "content": "lawmight/TCDynamics/apps/frontend/src/components/ErrorBoundary.tsx import React, { Component, ErrorInfo, ReactNode } from 'react' import { Button } from '@/components/ui/button' import { AlertTriangle, RefreshCw } from 'lucide-react' interface Props { children: ReactNode fallback?: ReactNode onError?: (error: Error, errorInfo: ErrorInfo) => void onReset?: () => void resetOnPropsChange?: boolean resetKeys?: Array<string | number> } interface State { hasError: boolean error?: Error errorInfo?: ErrorInfo resetCount: number } interface PerformanceMonitor { recordMetric: ( name: string, value: number, metadata?: Record<string, unknown> ) => void } interface WindowWithPerformanceMonitor extends Window { performanceMonitor?: PerformanceMonitor }",
      "metadata": {
        "source_type": "repository",
        "repository_project_id": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file_path": "lawmight/TCDynamics/apps/frontend/src/components/ErrorBoundary.tsx",
        "score": 0
      }
    },
    {
      "content": "lawmight/TCDynamics/apps/frontend/src/components/FAQ.tsx import { Badge } from '@/components/ui/badge' import { Card } from '@/components/ui/card' import { CheckCircle, Clock, Gift, HeadphonesIcon, Phone, Shield, Users, Wrench, } from 'lucide-react' import React, { createContext, useContext, useId, useState } from 'react' // Accordion Context for state management interface AccordionContextType { openItems: Set toggleItem: (value: string) => void } const AccordionContext = createContext (null) const useAccordion = () => { const context = useContext(AccordionContext) if (!context) { throw new Error( 'Accordion components must be used within an Accordion provider' ) } return context } // Main Accordion component const Accordion = ({ children, type = 'single', collapsible = true, }: { children: React.ReactNode type?: 'single' | 'multiple' collapsible?: boolean }) => { const [openItems, setOpenItems] = useState >(new Set()) const toggleItem = (value: string) => { setOpenItems(prev => { const newSet = new Set(prev) if (type === 'single') { // Single mode: close all others if (newSet.has(value)) { if (collapsible) { newSet.delete(value) } } else { newSet.clear() newSet.add(value) } } else { // Multiple mode: toggle individual items if (newSet.has(value)) { newSet.delete(value) } else { newSet.add(value) } } return newSet }) } return ( {children} ) } const AccordionItem = ({ children, value, className, }: { children: React.ReactNode value: string className?: string }) => ( {children} )",
      "metadata": {
        "source_type": "repository",
        "repository_project_id": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file_path": "lawmight/TCDynamics/apps/frontend/src/components/FAQ.tsx",
        "score": 0
      }
    },
    {
      "content": "lawmight/TCDynamics/apps/frontend/src/components/ui/card.tsx import * as React from 'react' import { cn } from '@/lib/utils' const Card = React.forwardRef >(({ className, ...props }, ref) => ( )) Card.displayName = 'Card' const CardHeader = React.forwardRef >(({ className, ...props }, ref) => ( )) CardHeader.displayName = 'CardHeader' const CardTitle = React.forwardRef >(({ className, ...props }, ref) => ( )) CardTitle.displayName = 'CardTitle' const CardDescription = React.forwardRef >(({ className, ...props }, ref) => ( )) CardDescription.displayName = 'CardDescription' const CardContent = React.forwardRef >(({ className, ...props }, ref) => ( )) CardContent.displayName = 'CardContent' const CardFooter = React.forwardRef >(({ className, ...props }, ref) => ( )) CardFooter.displayName = 'CardFooter' export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }",
      "metadata": {
        "source_type": "repository",
        "repository_project_id": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file_path": "lawmight/TCDynamics/apps/frontend/src/components/ui/card.tsx",
        "score": 0
      }
    },
    {
      "content": "lawmight/TCDynamics/apps/frontend/src/components/ui/tabs.tsx import * as React from 'react' import * as TabsPrimitive from '@radix-ui/react-tabs' import { cn } from '@/lib/utils' const Tabs = TabsPrimitive.Root const TabsList = React.forwardRef< React.ElementRef<typeof TabsPrimitive.List>, React.ComponentPropsWithoutRef<typeof TabsPrimitive.List> >(({ className, ...props }, ref) => ( <TabsPrimitive.List ref={ref} className={cn( 'inline-flex h-112 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground', className )} {...props} /> )) TabsList.displayName = TabsPrimitive.List.displayName const TabsTrigger = React.forwardRef< React.ElementRef<typeof TabsPrimitive.Trigger>, React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger> >(({ className, ...props }, ref) => ( <TabsPrimitive.Trigger ref={ref} className={cn( 'inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm', className )} {...props} /> )) TabsTrigger.displayName = TabsPrimitive.Trigger.displayName const TabsContent = React.forwardRef< React.ElementRef<typeof TabsPrimitive.Content>, React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content> >(({ className, ...props }, ref) => ( <TabsPrimitive.Content ref={ref} className={cn( 'mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2', className )} {...props} /> )) TabsContent.displayName = TabsPrimitive.Content.displayName export { Tabs, TabsList, TabsTrigger, TabsContent }",
      "metadata": {
        "source_type": "repository",
        "repository_project_id": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file_path": "lawmight/TCDynamics/apps/frontend/src/components/ui/tabs.tsx",
        "score": 0
      }
    },
    {
      "content": "lawmight/TCDynamics/apps/frontend/src/components/ThemeProvider.tsx import { createContext, useContext, useEffect, useState } from 'react' type Theme = 'light' | 'dark' | 'system' interface ThemeContextType { theme: Theme setTheme: (theme: Theme) => void resolvedTheme: 'light' | 'dark' } const ThemeContext = createContext<ThemeContextType | undefined>(undefined) /** * ThemeProvider component for managing light/dark/system theme modes * * Features: * - Supports three modes: 'light', 'dark', 'system' * - Persists theme preference in localStorage * - Automatically detects system color scheme preference * - Listens for system preference changes * - Applies theme class to document root element * * @example * ```tsx * <ThemeProvider> * <App /> * </ThemeProvider> * * // In components: * const { theme, setTheme, resolvedTheme } = useTheme() * ``` */ export function ThemeProvider({ children }: { children: React.ReactNode }) { // Initialize theme from localStorage or default to 'system' const [theme, setTheme] = useState<Theme>(() => { try { const stored = localStorage.getItem('theme') as Theme return stored || 'system' } catch { return 'system' } }) // Track the actual resolved theme (light or dark) const [resolvedTheme, setResolvedTheme] = useState<'light' | 'dark'>('light') // Resolve theme and apply to document useEffect(() => { const root = window.document.documentElement // Determine the actual theme to apply let resolved: 'light' | 'dark' = 'light' if (theme === 'system') { // Use system preference resolved = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' } else { // Use explicit theme resolved = theme } // Update state setResolvedTheme(resolved) // Apply to DOM root.classList.remove('light', 'dark') root.classList.add(resolved) // Persist to localStorage try { localStorage.setItem('theme', theme) } catch (error) { console.error('Failed to save theme preference:', error) } }, [theme]) // Listen for system preference changes (when theme is 'system') useEffect(() => { if (theme !== 'system') return const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)') const handleChange = () => { const newResolved = mediaQuery.matches ? 'dark' : 'light' setResolvedTheme(newResolved) // Update DOM const root = window.document.documentElement root.classList.remove('light', 'dark') root.classList.add(newResolved) } // Modern browsers support addEventListener mediaQuery.addEventListener('change', handleChange) return () => { mediaQuery.removeEventListener('change', handleChange) } }, [theme]) const value: ThemeContextType = { theme, setTheme, resolvedTheme, } return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider> } /** * Hook to access theme context * * @throws {Error} If used outside of ThemeProvider * * @example * ```tsx * function ThemeToggle() { * const { theme, setTheme, resolvedTheme } = useTheme() * * return ( * <button onClick={() => setTheme(theme ===",
      "metadata": {
        "source_type": "repository",
        "repository_project_id": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file_path": "lawmight/TCDynamics/apps/frontend/src/components/ThemeProvider.tsx",
        "score": 0
      }
    }
  ],
  "meta": {
    "search_mode": "repositories",
    "include_sources": true,
    "fast_mode": true,
    "resolved_repositories": [
      "lawmight/TCDynamics"
    ],
    "resolved_data_sources": []
  },
  "repository_result": {
    "results": [
      {
        "repository": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file": "lawmight/TCDynamics/apps/frontend/src/components/ErrorBoundary.tsx",
        "content": "lawmight/TCDynamics/apps/frontend/src/components/ErrorBoundary.tsx import React, { Component, ErrorInfo, ReactNode } from 'react' import { Button } from '@/components/ui/button' import { AlertTriangle, RefreshCw } from 'lucide-react' interface Props { children: ReactNode fallback?: ReactNode onError?: (error: Error, errorInfo: ErrorInfo) => void onReset?: () => void resetOnPropsChange?: boolean resetKeys?: Array<string | number> } interface State { hasError: boolean error?: Error errorInfo?: ErrorInfo resetCount: number } interface PerformanceMonitor { recordMetric: ( name: string, value: number, metadata?: Record<string, unknown> ) => void } interface WindowWithPerformanceMonitor extends Window { performanceMonitor?: PerformanceMonitor }",
        "score": 0
      },
      {
        "repository": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file": "lawmight/TCDynamics/apps/frontend/src/components/FAQ.tsx",
        "content": "lawmight/TCDynamics/apps/frontend/src/components/FAQ.tsx import { Badge } from '@/components/ui/badge' import { Card } from '@/components/ui/card' import { CheckCircle, Clock, Gift, HeadphonesIcon, Phone, Shield, Users, Wrench, } from 'lucide-react' import React, { createContext, useContext, useId, useState } from 'react' // Accordion Context for state management interface AccordionContextType { openItems: Set toggleItem: (value: string) => void } const AccordionContext = createContext (null) const useAccordion = () => { const context = useContext(AccordionContext) if (!context) { throw new Error( 'Accordion components must be used within an Accordion provider' ) } return context } // Main Accordion component const Accordion = ({ children, type = 'single', collapsible = true, }: { children: React.ReactNode type?: 'single' | 'multiple' collapsible?: boolean }) => { const [openItems, setOpenItems] = useState >(new Set()) const toggleItem = (value: string) => { setOpenItems(prev => { const newSet = new Set(prev) if (type === 'single') { // Single mode: close all others if (newSet.has(value)) { if (collapsible) { newSet.delete(value) } } else { newSet.clear() newSet.add(value) } } else { // Multiple mode: toggle individual items if (newSet.has(value)) { newSet.delete(value) } else { newSet.add(value) } } return newSet }) } return ( {children} ) } const AccordionItem = ({ children, value, className, }: { children: React.ReactNode value: string className?: string }) => ( {children} )",
        "score": 0
      },
      {
        "repository": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file": "lawmight/TCDynamics/apps/frontend/src/components/ui/card.tsx",
        "content": "lawmight/TCDynamics/apps/frontend/src/components/ui/card.tsx import * as React from 'react' import { cn } from '@/lib/utils' const Card = React.forwardRef >(({ className, ...props }, ref) => ( )) Card.displayName = 'Card' const CardHeader = React.forwardRef >(({ className, ...props }, ref) => ( )) CardHeader.displayName = 'CardHeader' const CardTitle = React.forwardRef >(({ className, ...props }, ref) => ( )) CardTitle.displayName = 'CardTitle' const CardDescription = React.forwardRef >(({ className, ...props }, ref) => ( )) CardDescription.displayName = 'CardDescription' const CardContent = React.forwardRef >(({ className, ...props }, ref) => ( )) CardContent.displayName = 'CardContent' const CardFooter = React.forwardRef >(({ className, ...props }, ref) => ( )) CardFooter.displayName = 'CardFooter' export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }",
        "score": 0
      },
      {
        "repository": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file": "lawmight/TCDynamics/apps/frontend/src/components/ui/tabs.tsx",
        "content": "lawmight/TCDynamics/apps/frontend/src/components/ui/tabs.tsx import * as React from 'react' import * as TabsPrimitive from '@radix-ui/react-tabs' import { cn } from '@/lib/utils' const Tabs = TabsPrimitive.Root const TabsList = React.forwardRef< React.ElementRef<typeof TabsPrimitive.List>, React.ComponentPropsWithoutRef<typeof TabsPrimitive.List> >(({ className, ...props }, ref) => ( <TabsPrimitive.List ref={ref} className={cn( 'inline-flex h-112 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground', className )} {...props} /> )) TabsList.displayName = TabsPrimitive.List.displayName const TabsTrigger = React.forwardRef< React.ElementRef<typeof TabsPrimitive.Trigger>, React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger> >(({ className, ...props }, ref) => ( <TabsPrimitive.Trigger ref={ref} className={cn( 'inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm', className )} {...props} /> )) TabsTrigger.displayName = TabsPrimitive.Trigger.displayName const TabsContent = React.forwardRef< React.ElementRef<typeof TabsPrimitive.Content>, React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content> >(({ className, ...props }, ref) => ( <TabsPrimitive.Content ref={ref} className={cn( 'mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2', className )} {...props} /> )) TabsContent.displayName = TabsPrimitive.Content.displayName export { Tabs, TabsList, TabsTrigger, TabsContent }",
        "score": 0
      },
      {
        "repository": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file": "lawmight/TCDynamics/apps/frontend/src/components/ThemeProvider.tsx",
        "content": "lawmight/TCDynamics/apps/frontend/src/components/ThemeProvider.tsx import { createContext, useContext, useEffect, useState } from 'react' type Theme = 'light' | 'dark' | 'system' interface ThemeContextType { theme: Theme setTheme: (theme: Theme) => void resolvedTheme: 'light' | 'dark' } const ThemeContext = createContext<ThemeContextType | undefined>(undefined) /** * ThemeProvider component for managing light/dark/system theme modes * * Features: * - Supports three modes: 'light', 'dark', 'system' * - Persists theme preference in localStorage * - Automatically detects system color scheme preference * - Listens for system preference changes * - Applies theme class to document root element * * @example * ```tsx * <ThemeProvider> * <App /> * </ThemeProvider> * * // In components: * const { theme, setTheme, resolvedTheme } = useTheme() * ``` */ export function ThemeProvider({ children }: { children: React.ReactNode }) { // Initialize theme from localStorage or default to 'system' const [theme, setTheme] = useState<Theme>(() => { try { const stored = localStorage.getItem('theme') as Theme return stored || 'system' } catch { return 'system' } }) // Track the actual resolved theme (light or dark) const [resolvedTheme, setResolvedTheme] = useState<'light' | 'dark'>('light') // Resolve theme and apply to document useEffect(() => { const root = window.document.documentElement // Determine the actual theme to apply let resolved: 'light' | 'dark' = 'light' if (theme === 'system') { // Use system preference resolved = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light' } else { // Use explicit theme resolved = theme } // Update state setResolvedTheme(resolved) // Apply to DOM root.classList.remove('light', 'dark') root.classList.add(resolved) // Persist to localStorage try { localStorage.setItem('theme', theme) } catch (error) { console.error('Failed to save theme preference:', error) } }, [theme]) // Listen for system preference changes (when theme is 'system') useEffect(() => { if (theme !== 'system') return const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)') const handleChange = () => { const newResolved = mediaQuery.matches ? 'dark' : 'light' setResolvedTheme(newResolved) // Update DOM const root = window.document.documentElement root.classList.remove('light', 'dark') root.classList.add(newResolved) } // Modern browsers support addEventListener mediaQuery.addEventListener('change', handleChange) return () => { mediaQuery.removeEventListener('change', handleChange) } }, [theme]) const value: ThemeContextType = { theme, setTheme, resolvedTheme, } return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider> } /** * Hook to access theme context * * @throws {Error} If used outside of ThemeProvider * * @example * ```tsx * function ThemeToggle() { * const { theme, setTheme, resolvedTheme } = useTheme() * * return ( * <button onClick={() => setTheme(theme ===",
        "score": 0
      }
    ],
    "total_results": 5,
    "repositories_searched": 1
  },
  "documentation_result": null
}

5. [Source 5] query({"query": "API route handler express middleware validation error handling request response", "repositories": ["lawmight/TCDynamics"], "search_mode": "repositories"}): {
  "content": "Query='API route handler express middleware validation error handling request response'. Repo results=5 (projects=1). Doc results=0 (sources=0).",
  "sources": [
    {
      "content": "lawmight/TCDynamics/apps/backend/src/middleware/errorHandler.js const { logError, logger } = require('../utils/logger') // Error types class ValidationError extends Error { constructor(message, field) { super(message) this.name = 'ValidationError' this.field = field this.statusCode = 400 } } class AuthenticationError extends Error { constructor(message) { super(message) this.name = 'AuthenticationError' this.statusCode = 401 } } class AuthorizationError extends Error { constructor(message) { super(message) this.name = 'AuthorizationError' this.statusCode = 403 } } class NotFoundError extends Error { constructor(message) { super(message) this.name = 'NotFoundError' this.statusCode = 404 } } class ConflictError extends Error { constructor(message) { super(message) this.name = 'ConflictError' this.statusCode = 409 } } class RateLimitError extends Error { constructor(message, retryAfter) { super(message) this.name = 'RateLimitError' this.statusCode = 429 this.retryAfter = retryAfter } } // Error response formatter const formatErrorResponse = (error, req) => { const isDevelopment = process.env.NODE_ENV === 'development' const baseResponse = { success: false, message: error.message || 'Une erreur est survenue', timestamp: new Date().toISOString(), path: req.path, method: req.method, } // Add additional details in development if (process.env.NODE_ENV === 'development') { baseResponse.error = { name: error.name, stack: error.stack, ...(error.field && { field: error.field }), } } // Add retry information for rate limiting if (error.name === 'RateLimitError' && error.retryAfter) { baseResponse.retryAfter = error.retryAfter } return baseResponse } // Global error handler middleware const errorHandler = (error, req, res, next) => { // Log the error with context logError(error, { url: req.url, method: req.method, ip: req.ip, userAgent: req.get('User-Agent'), requestId: req.headers['x-request-id'], body: req.method !== 'GET' ? req.body : undefined, query: req.query, params: req.params, headers: process.env.NODE_ENV === 'development' ? req.headers : undefined, }) // Determine status code const statusCode = error.statusCode || 500 // Format error response const errorResponse = formatErrorResponse(error, req) // Send response res.status(statusCode).json(errorResponse) } // Async error wrapper const asyncHandler = fn => (req, res, next) => { Promise.resolve(fn(req, res, next)).catch(next) } // 404 handler const notFoundHandler = (req, res, next) => { const error = new NotFoundError(`Route ${req.method} ${req.path} non trouv e`) next(error) } // Validation error handler for Joi const handleValidationError = error => { if (error.isJoi) { const field = error.details[0].path.join('.') const message = error.details[0].message return new ValidationError(message, field) } return error } // Database error handler",
      "metadata": {
        "source_type": "repository",
        "repository_project_id": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file_path": "lawmight/TCDynamics/apps/backend/src/middleware/errorHandler.js",
        "score": 0
      }
    },
    {
      "content": "lawmight/TCDynamics/apps/backend/src/config/middleware.ts /** * Middleware configuration * Centralizes middleware setup and configuration */ import express, { Express, Request, Response } from 'express' import cors from 'cors' import compression from 'compression' import morgan from 'morgan' import { EnvironmentConfig } from './environment' // Import middleware modules const securityModule = require('../middleware/security') const csrfModule = require('../middleware/csrf') const loggerModule = require('../utils/logger') const errorModule = require('../middleware/errorHandler') const monitoringModule = require('../routes/monitoring') /** * Configure and apply all middleware to Express app */ export function configureMiddleware( app: Express, config: EnvironmentConfig ): void { const { addRequestId } = loggerModule const { helmetConfig, validateIP, sanitizeInput } = securityModule const { csrfToken, csrfProtection } = csrfModule const { collectMetrics } = monitoringModule // Request ID middleware (must be first) app.use(addRequestId) // Security headers app.use(helmetConfig) // Compression app.use( compression({ level: 6, threshold: 1024, // Only compress responses > 1KB filter: (req: Request, res: Response) => { if (req.headers['x-no-compression']) { return false } return compression.filter(req, res) }, }) ) // CORS configuration const corsOptions: cors.CorsOptions = { origin: (origin: string | undefined, callback: (err: Error | null, allow?: boolean) => void) => { // Allow requests with no origin (like mobile apps or curl requests) if (!origin) return callback(null, true) if (config.allowedOrigins.includes(origin)) { callback(null, true) } else { callback(new Error('Not allowed by CORS')) } }, credentials: true, } app.use(cors(corsOptions)) // Logging app.use(morgan('combined')) // Body parsing app.use( express.json({ limit: '10mb', verify: (req: Request, _res: Response, buf: Buffer) => { // Store raw body for webhook verification if needed ;(req as Request & { rawBody?: Buffer }).rawBody = buf }, }) ) app.use(express.urlencoded({ extended: true, limit: '10mb' })) // Metrics collection app.use(collectMetrics) // Security middleware app.use(validateIP) app.use(sanitizeInput) // CSRF protection app.use(csrfToken) app.use(csrfProtection) } /** * Configure error handling middleware (mus",
      "metadata": {
        "source_type": "repository",
        "repository_project_id": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file_path": "lawmight/TCDynamics/apps/backend/src/config/middleware.ts",
        "score": 0
      }
    },
    {
      "content": "lawmight/TCDynamics/apps/backend/src/types/routes.d.ts /** * Type definitions for route modules * These types help ensure consistency across route handlers */ import { Request, Response, NextFunction } from 'express' /** * Standard route handler type */ export type RouteHandler = ( req: Request, res: Response, next: NextFunction ) => void | Promise<void> /** * Async route handler type */ export type AsyncRouteHandler = ( req: Request, res: Response, next: NextFunction ) => Promise<void> /** * Error handler type */ export type ErrorHandler = ( err: Error, req: Request, res: Response, next: NextFunction ) => void /** * Middleware type */ export type Middleware = ( req: Request, res: Response, next: NextFunction ) => void | Promise<void> /** * Request with raw body (for webhook verification) */ export interface RequestWithRawBody extends Request { rawBody?: Buffer } /** * Response with CSRF token in locals */ export interface ResponseWithCsrf extends Response { locals: { csr",
      "metadata": {
        "source_type": "repository",
        "repository_project_id": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file_path": "lawmight/TCDynamics/apps/backend/src/types/routes.d.ts",
        "score": 0
      }
    },
    {
      "content": "lawmight/TCDynamics/apps/backend/src/routes/__tests__/demo.test.js // Mock dependencies BEFORE importing modules jest.mock('../../config/email', () => ({ createTransporter: jest.fn(), emailTemplates: { demo: jest.fn(), }, })) jest.mock('../../utils/validation', () => ({ validateData: jest.fn(), demoSchema: { parse: jest.fn(), }, })) jest.mock('../../middleware/security', () => ({ formRateLimit: jest.fn(), })) jest.mock('../../utils/logger', () => ({ logger: { info: jest.fn(), error: jest.fn(), }, })) const request = require('supertest') const express = require('express') // Import after mocks are set up const { createTransporter, emailTemplates } = require('../../config/email') const { validateData } = require('../../utils/validation') const { formRateLimit } = require('../../middleware/security') const { logger } = require('../../utils/logger') // Create a test router instead of importing the real one const router = express.Router() // Add the route handler manually for testing - avec validation basique",
      "metadata": {
        "source_type": "repository",
        "repository_project_id": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file_path": "lawmight/TCDynamics/apps/backend/src/routes/__tests__/demo.test.js",
        "score": 0
      }
    },
    {
      "content": "lawmight/TCDynamics/apps/backend/src/middleware/errorHandler.js onst handleDatabaseError = error => { if (error.code === '23505') { // Unique constraint violation return new ConflictError('Un enregistrement avec ces donn es existe d j ') } if (error.code === '23503') { // Foreign key constraint violation return new NotFoundError('R f rence introuvable') } if (error.code === '23502') { // Not null constraint violation return new ValidationError('Champ requis manquant') } // Log database errors logger.error('Database error', { error: error.message, code: error.code }) return new Error('Erreur de base de donn es') } // Email error handler const handleEmailError = error => { logger.error('Email service error', { error: error.message }) return new Error(\"Erreur lors de l'envoi de l'email\") } module.exports = { ValidationError, AuthenticationError, AuthorizationError, NotFoundError, ConflictError, RateLimitError, errorHandler, asyncHandler, notFoundHandler, handleValidationError, handleDatabaseError, handleEmailError, }",
      "metadata": {
        "source_type": "repository",
        "repository_project_id": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file_path": "lawmight/TCDynamics/apps/backend/src/middleware/errorHandler.js",
        "score": 0
      }
    }
  ],
  "meta": {
    "search_mode": "repositories",
    "include_sources": true,
    "fast_mode": true,
    "resolved_repositories": [
      "lawmight/TCDynamics"
    ],
    "resolved_data_sources": []
  },
  "repository_result": {
    "results": [
      {
        "repository": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file": "lawmight/TCDynamics/apps/backend/src/middleware/errorHandler.js",
        "content": "lawmight/TCDynamics/apps/backend/src/middleware/errorHandler.js const { logError, logger } = require('../utils/logger') // Error types class ValidationError extends Error { constructor(message, field) { super(message) this.name = 'ValidationError' this.field = field this.statusCode = 400 } } class AuthenticationError extends Error { constructor(message) { super(message) this.name = 'AuthenticationError' this.statusCode = 401 } } class AuthorizationError extends Error { constructor(message) { super(message) this.name = 'AuthorizationError' this.statusCode = 403 } } class NotFoundError extends Error { constructor(message) { super(message) this.name = 'NotFoundError' this.statusCode = 404 } } class ConflictError extends Error { constructor(message) { super(message) this.name = 'ConflictError' this.statusCode = 409 } } class RateLimitError extends Error { constructor(message, retryAfter) { super(message) this.name = 'RateLimitError' this.statusCode = 429 this.retryAfter = retryAfter } } // Error response formatter const formatErrorResponse = (error, req) => { const isDevelopment = process.env.NODE_ENV === 'development' const baseResponse = { success: false, message: error.message || 'Une erreur est survenue', timestamp: new Date().toISOString(), path: req.path, method: req.method, } // Add additional details in development if (process.env.NODE_ENV === 'development') { baseResponse.error = { name: error.name, stack: error.stack, ...(error.field && { field: error.field }), } } // Add retry information for rate limiting if (error.name === 'RateLimitError' && error.retryAfter) { baseResponse.retryAfter = error.retryAfter } return baseResponse } // Global error handler middleware const errorHandler = (error, req, res, next) => { // Log the error with context logError(error, { url: req.url, method: req.method, ip: req.ip, userAgent: req.get('User-Agent'), requestId: req.headers['x-request-id'], body: req.method !== 'GET' ? req.body : undefined, query: req.query, params: req.params, headers: process.env.NODE_ENV === 'development' ? req.headers : undefined, }) // Determine status code const statusCode = error.statusCode || 500 // Format error response const errorResponse = formatErrorResponse(error, req) // Send response res.status(statusCode).json(errorResponse) } // Async error wrapper const asyncHandler = fn => (req, res, next) => { Promise.resolve(fn(req, res, next)).catch(next) } // 404 handler const notFoundHandler = (req, res, next) => { const error = new NotFoundError(`Route ${req.method} ${req.path} non trouv e`) next(error) } // Validation error handler for Joi const handleValidationError = error => { if (error.isJoi) { const field = error.details[0].path.join('.') const message = error.details[0].message return new ValidationError(message, field) } return error } // Database error handler",
        "score": 0
      },
      {
        "repository": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file": "lawmight/TCDynamics/apps/backend/src/config/middleware.ts",
        "content": "lawmight/TCDynamics/apps/backend/src/config/middleware.ts /** * Middleware configuration * Centralizes middleware setup and configuration */ import express, { Express, Request, Response } from 'express' import cors from 'cors' import compression from 'compression' import morgan from 'morgan' import { EnvironmentConfig } from './environment' // Import middleware modules const securityModule = require('../middleware/security') const csrfModule = require('../middleware/csrf') const loggerModule = require('../utils/logger') const errorModule = require('../middleware/errorHandler') const monitoringModule = require('../routes/monitoring') /** * Configure and apply all middleware to Express app */ export function configureMiddleware( app: Express, config: EnvironmentConfig ): void { const { addRequestId } = loggerModule const { helmetConfig, validateIP, sanitizeInput } = securityModule const { csrfToken, csrfProtection } = csrfModule const { collectMetrics } = monitoringModule // Request ID middleware (must be first) app.use(addRequestId) // Security headers app.use(helmetConfig) // Compression app.use( compression({ level: 6, threshold: 1024, // Only compress responses > 1KB filter: (req: Request, res: Response) => { if (req.headers['x-no-compression']) { return false } return compression.filter(req, res) }, }) ) // CORS configuration const corsOptions: cors.CorsOptions = { origin: (origin: string | undefined, callback: (err: Error | null, allow?: boolean) => void) => { // Allow requests with no origin (like mobile apps or curl requests) if (!origin) return callback(null, true) if (config.allowedOrigins.includes(origin)) { callback(null, true) } else { callback(new Error('Not allowed by CORS')) } }, credentials: true, } app.use(cors(corsOptions)) // Logging app.use(morgan('combined')) // Body parsing app.use( express.json({ limit: '10mb', verify: (req: Request, _res: Response, buf: Buffer) => { // Store raw body for webhook verification if needed ;(req as Request & { rawBody?: Buffer }).rawBody = buf }, }) ) app.use(express.urlencoded({ extended: true, limit: '10mb' })) // Metrics collection app.use(collectMetrics) // Security middleware app.use(validateIP) app.use(sanitizeInput) // CSRF protection app.use(csrfToken) app.use(csrfProtection) } /** * Configure error handling middleware (mus",
        "score": 0
      },
      {
        "repository": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file": "lawmight/TCDynamics/apps/backend/src/types/routes.d.ts",
        "content": "lawmight/TCDynamics/apps/backend/src/types/routes.d.ts /** * Type definitions for route modules * These types help ensure consistency across route handlers */ import { Request, Response, NextFunction } from 'express' /** * Standard route handler type */ export type RouteHandler = ( req: Request, res: Response, next: NextFunction ) => void | Promise<void> /** * Async route handler type */ export type AsyncRouteHandler = ( req: Request, res: Response, next: NextFunction ) => Promise<void> /** * Error handler type */ export type ErrorHandler = ( err: Error, req: Request, res: Response, next: NextFunction ) => void /** * Middleware type */ export type Middleware = ( req: Request, res: Response, next: NextFunction ) => void | Promise<void> /** * Request with raw body (for webhook verification) */ export interface RequestWithRawBody extends Request { rawBody?: Buffer } /** * Response with CSRF token in locals */ export interface ResponseWithCsrf extends Response { locals: { csr",
        "score": 0
      },
      {
        "repository": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file": "lawmight/TCDynamics/apps/backend/src/routes/__tests__/demo.test.js",
        "content": "lawmight/TCDynamics/apps/backend/src/routes/__tests__/demo.test.js // Mock dependencies BEFORE importing modules jest.mock('../../config/email', () => ({ createTransporter: jest.fn(), emailTemplates: { demo: jest.fn(), }, })) jest.mock('../../utils/validation', () => ({ validateData: jest.fn(), demoSchema: { parse: jest.fn(), }, })) jest.mock('../../middleware/security', () => ({ formRateLimit: jest.fn(), })) jest.mock('../../utils/logger', () => ({ logger: { info: jest.fn(), error: jest.fn(), }, })) const request = require('supertest') const express = require('express') // Import after mocks are set up const { createTransporter, emailTemplates } = require('../../config/email') const { validateData } = require('../../utils/validation') const { formRateLimit } = require('../../middleware/security') const { logger } = require('../../utils/logger') // Create a test router instead of importing the real one const router = express.Router() // Add the route handler manually for testing - avec validation basique",
        "score": 0
      },
      {
        "repository": "665a7f9e-098f-442c-b93d-29c23cfbc5ce",
        "file": "lawmight/TCDynamics/apps/backend/src/middleware/errorHandler.js",
        "content": "lawmight/TCDynamics/apps/backend/src/middleware/errorHandler.js onst handleDatabaseError = error => { if (error.code === '23505') { // Unique constraint violation return new ConflictError('Un enregistrement avec ces donn es existe d j ') } if (error.code === '23503') { // Foreign key constraint violation return new NotFoundError('R f rence introuvable') } if (error.code === '23502') { // Not null constraint violation return new ValidationError('Champ requis manquant') } // Log database errors logger.error('Database error', { error: error.message, code: error.code }) return new Error('Erreur de base de donn es') } // Email error handler const handleEmailError = error => { logger.error('Email service error', { error: error.message }) return new Error(\"Erreur lors de l'envoi de l'email\") } module.exports = { ValidationError, AuthenticationError, AuthorizationError, NotFoundError, ConflictError, RateLimitError, errorHandler, asyncHandler, notFoundHandler, handleValidationError, handleDatabaseError, handleEmailError, }",
        "score": 0
      }
    ],
    "total_results": 5,
    "repositories_searched": 1
  },
  "documentation_result": null
}

6. [Source 6] read_source_content({"source": "lawmight/TCDynamics:apps/backend/src/utils/validation.js"}): {
  "source": "lawmight/TCDynamics:apps/backend/src/utils/validation.js",
  "content": "const Joi = require('joi')\nconst { commonFields } = require('./validationHelpers')\n\n// Sch\u00e9ma de validation pour le formulaire de contact\n// Uses reusable validation helpers for consistency\nconst contactSchema = Joi.object({\n  name: commonFields.fullName(),\n  email: commonFields.email(),\n  phone: commonFields.phone(),\n  company: commonFields.company(false), // optional\n  message: commonFields.message(),\n})\n\n// Sch\u00e9ma de validation pour le formulaire de d\u00e9mo\n// Uses reusable validation helpers for consistency\nconst demoSchema = Joi.object({\n  firstName: commonFields.firstName(),\n  lastName: commonFields.lastName(),\n  email: commonFields.email(),\n  phone: commonFields.phone(),\n  company: commonFields.company(true), // required\n  employees: commonFields.employees(),\n  needs: commonFields.notes(1000),\n})\n\n// Fonction de validation g\u00e9n\u00e9rique\nconst validateData = schema => {\n  return (req, res, next) => {\n    const { error, value } = schema.validate(req.body, {\n      abortEarly: false,\n      stripUnknown: true,\n    })\n\n    if (error) {\n      const errorMessages = error.details.map(detail => detail.message)\n      return res.status(400).json({\n        success: false,\n        message: 'Donn\u00e9es invalides',\n        errors: errorMessages,\n      })\n    }\n\n    req.body = value // Utiliser les donn\u00e9es nettoy\u00e9es\n    next()\n  }\n}\n\nmodule.exports = {\n  contactSchema,\n  demoSchema,\n  validateData,\n}\n",
  "language": "js",
  "truncated": false,
  "original_size": 1404
}

7. [Source 7] read_source_content({"source": "lawmight/TCDynamics:apps/frontend/src/hooks/useFormSubmit.ts"}): {
  "source": "lawmight/TCDynamics:apps/frontend/src/hooks/useFormSubmit.ts",
  "content": "import { track } from '@vercel/analytics'\nimport { useState } from 'react'\n\nimport type { ApiResponse } from '@/utils/apiConfig'\nimport { logger } from '@/utils/logger'\n\n/**\n * Configuration for form submission endpoints\n */\ninterface FormSubmitConfig {\n  /** Primary endpoint (typically Azure Functions) */\n  primaryEndpoint: string\n  /** Fallback endpoint (typically Node.js backend) */\n  fallbackEndpoint: string\n  /** Whether to enable automatic fallback on primary endpoint failure */\n  enableFallback?: boolean\n  /** Custom error message for submission failures */\n  errorMessage?: string\n}\n\n/**\n * Options for form submission behavior\n */\ninterface SubmitOptions {\n  /** Callback executed on successful submission */\n  onSuccess?: (response: ApiResponse) => void\n  /** Callback executed on submission error */\n  onError?: (error: Error, response: ApiResponse) => void\n  /** Whether to check for fallback conditions (default: true for 5xx errors) */\n  shouldFallback?: (error: unknown) => boolean\n}\n\n/**\n * Return type for the useFormSubmit hook\n */\ninterface UseFormSubmitReturn<T> {\n  /** Function to submit form data */\n  submitForm: (data: T, options?: SubmitOptions) => Promise<ApiResponse>\n  /** Whether form is currently submitting */\n  isSubmitting: boolean\n  /** Response from last submission */\n  response: ApiResponse | null\n  /** Clear the current response */\n  clearResponse: () => void\n  /** Whether last submission had errors */\n  hasErrors: boolean\n  /** Whether last submission was successful */\n  isSuccess: boolean\n  /** Array of error messages from last submission */\n  errors: string[]\n  /** Message from last submission */\n  message: string\n}\n\n/**\n * Default fallback condition: fallback on network errors and 5xx server errors\n */\nconst defaultShouldFallback = (error: unknown): boolean => {\n  // Network errors (not a Response)\n  const isResponse =\n    typeof error === 'object' && error !== null && 'status' in error\n  if (!isResponse) {\n    return true\n  }\n  // Service unavailable or server errors\n  const err = error as { status?: number }\n  return err.status === 503 || (err.status ?? 0) >= 500\n}\n\n/**\n * Generic form submission hook with primary/fallback endpoint support\n *\n * @template T - Type of form data being submitted\n * @param config - Configuration for endpoints and behavior\n * @returns Form submission state and controls\n *\n * @example\n * ```tsx\n * const { submitForm, isSubmitting, isSuccess } = useFormSubmit<ContactFormData>({\n *   primaryEndpoint: API_ENDPOINTS.azureContact,\n *   fallbackEndpoint: API_ENDPOINTS.contact,\n * })\n *\n * await submitForm(formData, {\n *   onSuccess: (res) => console.log('Success!', res),\n *   onError: (err) => console.error('Failed!', err)\n * })\n * ```\n */\nexport const useFormSubmit = <T = Record<string, unknown>>(\n  config: FormSubmitConfig\n): UseFormSubmitReturn<T> => {\n  const [isSubmitting, setIsSubmitting] = useState(false)\n  const [response, setResponse] = useState<ApiResponse | null>(null)\n\n  const {\n    primaryEndpoint,\n    fallbackEndpoint,\n    enableFallback = true,\n    errorMessage = 'Une erreur est survenue',\n  } = config\n\n  const submitForm = async (\n    data: T,\n    options: SubmitOptions = {}\n  ): Promise<ApiResponse> => {\n    const {\n      onSuccess,\n      onError,\n      shouldFallback = defaultShouldFallback,\n    } = options\n\n    setIsSubmitting(true)\n    setResponse(null)\n\n    // Resolve the (possibly mocked) apiRequest at call time to avoid stale references in tests\n    const { apiRequest } = await import('@/utils/apiConfig')\n\n    const performRequest = async () => {\n      try {\n        return await apiRequest<ApiResponse>(primaryEndpoint, {\n          method: 'POST',\n          body: JSON.stringify(data),\n        })\n      } catch (primaryError) {\n        const canFallback = enableFallback && shouldFallback(primaryError)\n        logger.warn?.(`Primary endpoint failed, evaluating fallback`, {\n          primary: primaryEndpoint,\n          fallback: fallbackEndpoint,\n          error: primaryError,\n        })\n        if (!canFallback) throw primaryError\n\n        return await apiRequest<ApiResponse>(fallbackEndpoint, {\n          method: 'POST',\n          body: JSON.stringify(data),\n        })\n      }\n    }\n\n    try {\n      const result = await performRequest()\n      const safeResult: ApiResponse =\n        result ??\n        ({\n          success: false,\n          message: errorMessage,\n          errors: [errorMessage],\n        } as ApiResponse)\n\n      setResponse(safeResult)\n      setIsSubmitting(false)\n\n      if (safeResult.success) {\n        try {\n          track?.('form_submitted', {\n            endpoint: primaryEndpoint,\n            timestamp: new Date().toISOString(),\n          })\n        } catch {\n          // Ignore analytics failures in tests/runtime\n        }\n        onSuccess?.(safeResult)\n      } else {\n        try {\n          track?.('form_error', {\n            endpoint: primaryEndpoint,\n            errorType: 'validation',\n            errorMessage: safeResult.message || 'Validation error',\n            timestamp: new Date().toISOString(),\n          })\n        } catch {\n          // Ignore analytics failures\n        }\n      }\n\n      return safeResult\n    } catch (error) {\n      const normalizedMessage =\n        error instanceof Error ? error.message : errorMessage\n\n      const errorResponse: ApiResponse = {\n        success: false,\n        message: normalizedMessage,\n        errors: [normalizedMessage],\n      }\n\n      setResponse(errorResponse)\n      setIsSubmitting(false)\n\n      try {\n        track?.('form_error', {\n          endpoint: primaryEndpoint,\n          errorType: 'submission',\n          errorMessage: normalizedMessage,\n          timestamp: new Date().toISOString(),\n        })\n      } catch {\n        // Ignore analytics failures\n      }\n\n      onError?.(\n        error instanceof Error ? error : new Error(errorMessage),\n        errorResponse\n      )\n\n      return errorResponse\n    }\n  }\n\n  const clearResponse = () => {\n    setResponse(null)\n  }\n\n  const hasErrors = response?.success === false\n  const isSuccess = response?.success === true\n\n  return {\n    submitForm,\n    isSubmitting,\n    response,\n    clearResponse,\n    hasErrors,\n    isSuccess,\n    errors: response?.errors || [],\n    message: response?.message || '',\n  }\n}\n",
  "language": "ts",
  "truncated": false,
  "original_size": 6306
}

8. [Source 8] read_source_content({"source": "lawmight/TCDynamics:apps/frontend/src/components/__tests__/Contact.test.tsx"}): {
  "source": "lawmight/TCDynamics:apps/frontend/src/components/__tests__/Contact.test.tsx",
  "content": "import { QueryClient, QueryClientProvider } from '@tanstack/react-query'\nimport { render, screen, fireEvent, waitFor } from '@testing-library/react'\n\nimport Contact from '../Contact'\n\nconst queryClient = new QueryClient({\n  defaultOptions: {\n    queries: { retry: false },\n    mutations: { retry: false },\n  },\n})\n\nconst ContactWrapper = ({ children }: { children: React.ReactNode }) => (\n  <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>\n)\n\ndescribe('Contact Component', () => {\n  it('should render contact form', () => {\n    render(\n      <ContactWrapper>\n        <Contact />\n      </ContactWrapper>\n    )\n\n    expect(screen.getByText(/Contactez-nous/i)).toBeInTheDocument()\n    expect(screen.getByPlaceholderText(/Pr\u00e9nom/i)).toBeInTheDocument()\n    expect(screen.getByPlaceholderText(/votre@email.fr/i)).toBeInTheDocument()\n  })\n\n  it('should have all form fields', () => {\n    render(\n      <ContactWrapper>\n        <Contact />\n      </ContactWrapper>\n    )\n\n    // Check for form labels (there are multiple forms, so we use getAllByText)\n    expect(screen.getAllByText(/Pr\u00e9nom/i).length).toBeGreaterThan(0)\n    expect(screen.getAllByText(/Email professionnel/i).length).toBeGreaterThan(\n      0\n    )\n    expect(screen.getAllByText(/T\u00e9l\u00e9phone/i).length).toBeGreaterThan(0)\n    expect(screen.getAllByText(/Entreprise/i).length).toBeGreaterThan(0)\n    expect(screen.getAllByText(/Message/i).length).toBeGreaterThan(0)\n  })\n\n  it('should validate required fields', async () => {\n    render(\n      <ContactWrapper>\n        <Contact />\n      </ContactWrapper>\n    )\n\n    const submitButton = screen.getByText(/Envoyer le message/i)\n    fireEvent.click(submitButton)\n\n    // Le formulaire ne devrait pas \u00eatre soumis sans les champs requis\n    await waitFor(() => {\n      const emailInputs = screen.getAllByPlaceholderText(/email/i)\n      const emailInput = emailInputs[emailInputs.length - 1] as HTMLInputElement\n      expect(emailInput.validity.valid).toBe(false)\n    })\n  })\n\n  it('should display contact information', () => {\n    render(\n      <ContactWrapper>\n        <Contact />\n      </ContactWrapper>\n    )\n\n    expect(\n      screen.getByText(/78180 Montigny-le-Bretonneux/i)\n    ).toBeInTheDocument()\n  })\n\n  it('should show business hours', () => {\n    render(\n      <ContactWrapper>\n        <Contact />\n      </ContactWrapper>\n    )\n\n    expect(screen.getByText(/Lundi-Vendredi 8h-19h/i)).toBeInTheDocument()\n  })\n})\n",
  "language": "tsx",
  "truncated": false,
  "original_size": 2453
}

9. [Source 9] read_source_content({"source": "lawmight/TCDynamics:apps/frontend/src/lib/supabaseClient.ts"}): {
  "source": "lawmight/TCDynamics:apps/frontend/src/lib/supabaseClient.ts",
  "content": "import { createClient, type SupabaseClient } from '@supabase/supabase-js'\n\ntype ClientOrNull = SupabaseClient | null\n\nlet cached: ClientOrNull = null\n\nconst getEnv = (key: string) => import.meta.env[key]\n\nexport const getSupabaseClient = (): SupabaseClient => {\n  if (cached) return cached\n\n  const supabaseUrl = getEnv('VITE_SUPABASE_URL')\n  const supabaseAnonKey = getEnv('VITE_SUPABASE_ANON_KEY')\n\n  if (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error(\n      'Supabase is not configured. Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY.'\n    )\n  }\n\n  cached = createClient(supabaseUrl, supabaseAnonKey, {\n    auth: {\n      autoRefreshToken: true,\n      persistSession: true,\n    },\n  })\n\n  return cached\n}\n",
  "language": "ts",
  "truncated": false,
  "original_size": 718
}

10. [Source 10] read_source_content({"source": "lawmight/TCDynamics:apps/frontend/src/utils/apiConfig.ts"}): {
  "source": "lawmight/TCDynamics:apps/frontend/src/utils/apiConfig.ts",
  "content": "// API configuration for Vercel serverless functions\n// All endpoints use Vercel's serverless API routes\n\nexport const API_ENDPOINTS = {\n  // All endpoints now use Vercel serverless functions (relative URLs)\n  contact: `/api/forms`,\n  demo: `/api/forms`,\n  health: `/api/analytics?health=true`,\n  chat: `/api/chat`,\n  vision: `/api/vision`,\n  paymentIntent: `/api/payments?action=payment-intent`,\n  subscription: `/api/payments?action=subscription`,\n}\n\nexport interface ApiResponse {\n  success: boolean\n  message: string\n  messageId?: string\n  errors?: string[]\n}\n\nexport const apiRequest = async <T>(\n  url: string,\n  options: RequestInit = {}\n): Promise<T> => {\n  try {\n    const response = await fetch(url, {\n      ...options,\n      headers: {\n        'Content-Type': 'application/json',\n        ...options.headers,\n      },\n    })\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({\n        message: response.statusText,\n      }))\n      throw new Error(errorData.message || 'Une erreur est survenue')\n    }\n\n    return response.json()\n  } catch (error) {\n    if (error instanceof Error) {\n      throw error\n    }\n    throw new Error('Erreur de connexion au serveur')\n  }\n}\n",
  "language": "ts",
  "truncated": false,
  "original_size": 1211
}

11. [Source 11] read_source_content({"source": "lawmight/TCDynamics:tests/e2e/contact-flow.spec.ts"}): {
  "source": "lawmight/TCDynamics:tests/e2e/contact-flow.spec.ts",
  "content": "import { expect, test } from '@playwright/test'\n\ntest.describe('Contact Form Flow', () => {\n  test.beforeEach(async ({ page }) => {\n    await page.goto('/')\n  })\n\n  test('should complete contact form successfully', async ({ page }) => {\n    // Navigate to contact section\n    await page.click('text=Contact')\n\n    // Wait for form to be visible\n    await expect(page.locator('input[name=\"name\"]')).toBeVisible()\n\n    // Fill out the form\n    await page.fill('input[name=\"name\"]', 'John Doe')\n    await page.fill('input[name=\"email\"]', 'john.doe@example.com')\n    await page.fill('input[name=\"phone\"]', '+33123456789')\n    await page.fill('input[name=\"company\"]', 'Test Company')\n    await page.fill(\n      'textarea[name=\"message\"]',\n      'This is a test message from E2E tests'\n    )\n\n    // Submit the form\n    await page.click('button:has-text(\"Envoyer\")')\n\n    // Should show success message\n    await expect(page.locator('text=Message envoy\u00e9')).toBeVisible()\n    await expect(\n      page.locator('text=Nous vous r\u00e9pondrons dans les plus brefs d\u00e9lais')\n    ).toBeVisible()\n  })\n\n  test('should validate required fields', async ({ page }) => {\n    await page.click('text=Contact')\n\n    // Try to submit empty form\n    await page.click('button:has-text(\"Envoyer\")')\n\n    // Should show validation errors\n    await expect(page.locator('text=Le nom est requis')).toBeVisible()\n    await expect(page.locator(\"text=L'email est requis\")).toBeVisible()\n  })\n\n  test('should validate email format', async ({ page }) => {\n    await page.click('text=Contact')\n\n    // Fill form with invalid email\n    await page.fill('input[name=\"name\"]', 'John Doe')\n    await page.fill('input[name=\"email\"]', 'invalid-email')\n    await page.fill('textarea[name=\"message\"]', 'Test message')\n\n    await page.click('button:has-text(\"Envoyer\")')\n\n    // Should show email validation error\n    await expect(page.locator('text=Adresse email invalide')).toBeVisible()\n  })\n\n  test('should handle network errors gracefully', async ({ page }) => {\n    // Mock API failure\n    await page.route('**/api/contact', route => route.abort())\n\n    await page.click('text=Contact')\n\n    await page.fill('input[name=\"name\"]', 'John Doe')\n    await page.fill('input[name=\"email\"]', 'john.doe@example.com')\n    await page.fill('textarea[name=\"message\"]', 'Test message')\n\n    await page.click('button:has-text(\"Envoyer\")')\n\n    // Should show error message\n    await expect(page.locator(\"text=Erreur lors de l'envoi\")).toBeVisible()\n  })\n\n  test('should be responsive on mobile', async ({ page }) => {\n    // Set mobile viewport\n    await page.setViewportSize({ width: 375, height: 667 })\n\n    await page.click('text=Contact')\n\n    // Form should be accessible on mobile\n    await expect(page.locator('input[name=\"name\"]')).toBeVisible()\n\n    // Mobile menu should work\n    const mobileMenuButton = page.locator('button[aria-label*=\"menu\"]')\n    await mobileMenuButton.click()\n\n    await expect(page.locator('text=Accueil')).toBeVisible()\n  })\n})\n",
  "language": "ts",
  "truncated": false,
  "original_size": 3005
}

12. [Source 12] read_source_content({"source": "lawmight/TCDynamics:apps/frontend/eslint.config.js"}): {
  "source": "lawmight/TCDynamics:apps/frontend/eslint.config.js",
  "content": "import js from '@eslint/js'\nimport typescript from '@typescript-eslint/eslint-plugin'\nimport tsParser from '@typescript-eslint/parser'\nimport prettier from 'eslint-config-prettier'\nimport importPlugin from 'eslint-plugin-import'\nimport jsxA11y from 'eslint-plugin-jsx-a11y'\nimport reactHooks from 'eslint-plugin-react-hooks'\nimport tailwindcss from 'eslint-plugin-tailwindcss'\nimport globals from 'globals'\n\nexport default [\n  js.configs.recommended,\n  {\n    ignores: [\n      'dist/**',\n      'build/**',\n      'node_modules/**',\n      'coverage/**',\n      'public/**',\n      '*.config.{js,ts,mjs}',\n      '**/*.config.{js,ts,mjs}',\n      'playwright-report/**',\n      '*.js', // Ignore root-level .js files\n      'api.old/**', // Ignore legacy API folder\n    ],\n  },\n  {\n    files: ['**/*.{ts,tsx}'],\n    languageOptions: {\n      parser: tsParser,\n      parserOptions: {\n        ecmaVersion: 'latest',\n        sourceType: 'module',\n        ecmaFeatures: { jsx: true },\n      },\n      globals: {\n        ...globals.browser,\n        ...globals.node,\n        // Additional Web APIs\n        crypto: 'readonly',\n        TextEncoder: 'readonly',\n        TextDecoder: 'readonly',\n        URL: 'readonly',\n        URLSearchParams: 'readonly',\n        PerformanceEntry: 'readonly',\n        PerformanceNavigationTiming: 'readonly',\n        PerformanceResourceTiming: 'readonly',\n        Navigator: 'readonly',\n        ServiceWorkerRegistration: 'readonly',\n        RequestInit: 'readonly',\n        PerformanceObserver: 'readonly',\n        PerformanceObserverInit: 'readonly',\n        // Node.js types\n        NodeJS: 'readonly',\n        // React types\n        React: 'readonly',\n        JSX: 'readonly',\n      },\n    },\n    plugins: {\n      '@typescript-eslint': typescript,\n      'jsx-a11y': jsxA11y,\n      tailwindcss: tailwindcss,\n      import: importPlugin,\n      'react-hooks': reactHooks,\n    },\n    rules: {\n      // TypeScript strict rules\n      ...typescript.configs['recommended'].rules,\n      '@typescript-eslint/no-unused-vars': [\n        'warn',\n        {\n          argsIgnorePattern: '^_',\n          varsIgnorePattern: '^_',\n        },\n      ],\n      '@typescript-eslint/no-explicit-any': 'error',\n\n      // Accessibility - WCAG 2.1 AA Level\n      ...jsxA11y.configs.recommended.rules,\n      'jsx-a11y/alt-text': [\n        'error',\n        {\n          elements: ['img', 'object', 'area', 'input[type=\"image\"]'],\n        },\n      ],\n      'jsx-a11y/anchor-is-valid': [\n        'error',\n        {\n          components: ['Link'],\n          specialLink: ['to'],\n        },\n      ],\n      'jsx-a11y/click-events-have-key-events': 'error',\n      'jsx-a11y/interactive-supports-focus': 'error',\n      'jsx-a11y/label-has-associated-control': [\n        'error',\n        {\n          required: { some: ['nesting', 'id'] },\n        },\n      ],\n      'jsx-a11y/no-autofocus': ['warn', { ignoreNonDOM: true }],\n      'jsx-a11y/no-noninteractive-element-interactions': 'warn',\n\n      // Tailwind CSS\n      'tailwindcss/classnames-order': 'warn',\n      'tailwindcss/no-custom-classname': 'off', // Allow custom classes\n      'tailwindcss/no-contradicting-classname': 'error',\n\n      // Import organization\n      'import/order': [\n        'warn',\n        {\n          groups: [\n            'builtin',\n            'external',\n            'internal',\n            ['parent', 'sibling'],\n            'index',\n          ],\n          'newlines-between': 'always',\n          alphabetize: { order: 'asc' },\n        },\n      ],\n\n      // React Hooks\n      'react-hooks/rules-of-hooks': 'error',\n      'react-hooks/exhaustive-deps': 'warn',\n\n      // Code quality\n      'no-console': ['warn', { allow: ['warn', 'error'] }],\n      'prefer-const': 'error',\n      'no-var': 'error',\n    },\n    settings: {\n      'jsx-a11y': {\n        components: {\n          Button: 'button',\n          Input: 'input',\n          Textarea: 'textarea',\n          Select: 'select',\n          Link: 'a',\n        },\n        polymorphicPropName: 'as',\n      },\n      tailwindcss: {\n        callees: ['cn', 'clsx', 'cva'],\n        config: 'tailwind.config.ts',\n      },\n    },\n  },\n  {\n    // Override for test files\n    files: ['**/*.test.{ts,tsx}', '**/__tests__/**/*.{ts,tsx}'],\n    languageOptions: {\n      globals: {\n        ...globals.browser,\n        ...globals.node,\n        // Vitest globals\n        describe: 'readonly',\n        it: 'readonly',\n        test: 'readonly',\n        expect: 'readonly',\n        vi: 'readonly',\n        beforeEach: 'readonly',\n        afterEach: 'readonly',\n        beforeAll: 'readonly',\n        afterAll: 'readonly',\n        vitest: 'readonly',\n      },\n    },\n    rules: {\n      '@typescript-eslint/no-explicit-any': 'warn', // Allow 'as any' in tests for mocking\n    },\n  },\n  {\n    // Override for API serverless functions (JavaScript)\n    files: ['api/**/*.js'],\n    languageOptions: {\n      globals: {\n        ...globals.node,\n        require: 'readonly',\n        module: 'readonly',\n        exports: 'readonly',\n        console: 'readonly',\n        process: 'readonly',\n        Buffer: 'readonly',\n        fetch: 'readonly',\n        URL: 'readonly',\n        __dirname: 'readonly',\n        __filename: 'readonly',\n      },\n    },\n    rules: {\n      'no-console': 'off', // Allow console in API functions\n    },\n  },\n  {\n    // Override for UI component library - heading components receive children via spread props\n    files: ['**/components/ui/alert.tsx', '**/components/ui/card.tsx'],\n    rules: {\n      'jsx-a11y/heading-has-content': 'off', // Children passed via {...props}\n    },\n  },\n  prettier, // Must be last to override other configs\n]\n",
  "language": "js",
  "truncated": false,
  "original_size": 5644
}

13. [Source 13] read_source_content({"source": "lawmight/TCDynamics:apps/frontend/tailwind.config.ts"}): {
  "source": "lawmight/TCDynamics:apps/frontend/tailwind.config.ts",
  "content": "import type { Config } from 'tailwindcss'\nimport tailwindcssAnimate from 'tailwindcss-animate'\n\nexport default {\n  darkMode: ['class'],\n  content: [\n    './pages/**/*.{ts,tsx}',\n    './components/**/*.{ts,tsx}',\n    './app/**/*.{ts,tsx}',\n    './src/**/*.{ts,tsx}',\n  ],\n  prefix: '',\n  theme: {\n    container: {\n      center: true,\n      padding: '2rem',\n      screens: {\n        '2xl': '1400px',\n      },\n    },\n    extend: {\n      fontFamily: {\n        inter: ['Inter', 'sans-serif'],\n      },\n      colors: {\n        border: 'hsl(var(--border))',\n        input: 'hsl(var(--input))',\n        ring: 'hsl(var(--ring))',\n        background: 'hsl(var(--background))',\n        foreground: 'hsl(var(--foreground))',\n        primary: {\n          DEFAULT: 'hsl(var(--primary))',\n          foreground: 'hsl(var(--primary-foreground))',\n          glow: 'hsl(var(--primary-glow))',\n        },\n        secondary: {\n          DEFAULT: 'hsl(var(--secondary))',\n          foreground: 'hsl(var(--secondary-foreground))',\n        },\n        destructive: {\n          DEFAULT: 'hsl(var(--destructive))',\n          foreground: 'hsl(var(--destructive-foreground))',\n        },\n        muted: {\n          DEFAULT: 'hsl(var(--muted))',\n          foreground: 'hsl(var(--muted-foreground))',\n        },\n        accent: {\n          DEFAULT: 'hsl(var(--accent))',\n          foreground: 'hsl(var(--accent-foreground))',\n        },\n        popover: {\n          DEFAULT: 'hsl(var(--popover))',\n          foreground: 'hsl(var(--popover-foreground))',\n        },\n        card: {\n          DEFAULT: 'hsl(var(--card))',\n          foreground: 'hsl(var(--card-foreground))',\n        },\n        sidebar: {\n          DEFAULT: 'hsl(var(--sidebar-background))',\n          foreground: 'hsl(var(--sidebar-foreground))',\n          primary: 'hsl(var(--sidebar-primary))',\n          'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',\n          accent: 'hsl(var(--sidebar-accent))',\n          'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',\n          border: 'hsl(var(--sidebar-border))',\n          ring: 'hsl(var(--sidebar-ring))',\n        },\n      },\n      backgroundImage: {\n        'gradient-primary': 'var(--gradient-primary)',\n        'gradient-hero': 'var(--gradient-hero)',\n        'gradient-subtle': 'var(--gradient-subtle)',\n      },\n      boxShadow: {\n        elegant: 'var(--shadow-elegant)',\n        glow: 'var(--shadow-glow)',\n        button: 'var(--shadow-button)',\n      },\n      borderRadius: {\n        lg: 'var(--radius)',\n        md: 'calc(var(--radius) - 2px)',\n        sm: 'calc(var(--radius) - 4px)',\n      },\n      keyframes: {\n        'accordion-down': {\n          from: {\n            height: '0',\n          },\n          to: {\n            height: 'var(--radix-accordion-content-height)',\n          },\n        },\n        'accordion-up': {\n          from: {\n            height: 'var(--radix-accordion-content-height)',\n          },\n          to: {\n            height: '0',\n          },\n        },\n      },\n      animation: {\n        'accordion-down': 'accordion-down 0.2s ease-out',\n        'accordion-up': 'accordion-up 0.2s ease-out',\n      },\n    },\n  },\n  plugins: [tailwindcssAnimate],\n} satisfies Config\n",
  "language": "ts",
  "truncated": false,
  "original_size": 3216
}

14. [Source 14] read_source_content({"source": "lawmight/TCDynamics:api/_lib/auth.js"}): {
  "source": "lawmight/TCDynamics:api/_lib/auth.js",
  "content": "/**\n * Supabase Auth Verification Utility\n * Verifies JWT tokens in Vercel serverless functions\n */\n\nimport { getSupabaseClient } from './supabase.js'\n\n/**\n * Verify Supabase auth token and return user ID\n * @param {string} authHeader - Authorization header (Bearer token)\n * @returns {Promise<{userId: string | null, error: string | null}>}\n */\nexport async function verifySupabaseAuth(authHeader) {\n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    return { userId: null, error: 'Missing or invalid Authorization header' }\n  }\n\n  const token = authHeader.replace('Bearer ', '')\n  const supabase = getSupabaseClient()\n\n  try {\n    const {\n      data: { user },\n      error,\n    } = await supabase.auth.getUser(token)\n\n    if (error || !user) {\n      return { userId: null, error: error?.message || 'Invalid token' }\n    }\n\n    return { userId: user.id, error: null }\n  } catch (err) {\n    return { userId: null, error: err.message }\n  }\n}\n\nexport default {\n  verifySupabaseAuth,\n}\n\n\n\n\n\n\n\n\n\n\n\n\n",
  "language": "js",
  "truncated": false,
  "original_size": 1006
}

15. [Reflection] ## Research Synthesis

**Tech Stack Identified:**
- Frontend: React 18 + TypeScript + Vite + Tailwind CSS + ShadCN UI (Radix primitives)
- Backend: Node.js/Express + TypeScript
- Database: Supabase (PostgreSQL)
- API: Vercel serverless functions + Express backend
- Payments: Polar (migrated from Stripe)
- AI: Vertex AI integration
- Testing: Vitest + React Testing Library + Playwright E2E
- CI/CD: GitHub Actions + Vercel

**Security Patterns Found:**
- Helmet security headers with strict CSP
- Rate limiting (express-rate-limit)
- DOMPurify for XSS prevention
- CSRF protection middleware
- IP validation and bot detection
- Supabase JWT auth verification

**Code Style Conventions:**
- TypeScript strict mode with `@typescript-eslint/no-explicit-any: error`
- Accessibility-first (jsx-a11y WCAG 2.1 AA)
- Import ordering (external → internal → parent/sibling)
- Tailwind class ordering
- React hooks rules enforced
- No console.log (only warn/error allowed)

**Component Patterns:**
- TypeScript interfaces for Props/State
- React.forwardRef with displayName
- Context API with custom hooks (useAccordion, useTheme)
- cn() utility for class merging
- Comprehensive JSDoc documentation

**API Patterns:**
- Custom error classes hierarchy (ValidationError, AuthenticationError, etc.)
- asyncHandler wrapper for error propagation
- Joi validation schemas with reusable fields
- Primary/fallback endpoint pattern
- Request ID tracing

**Testing Patterns:**
- QueryClient wrapper for React Query
- describe/it structure
- getAllBy queries for multiple elements
- API mocking with route interception
- Mobile responsiveness testing

**Confidence: HIGH** - I have all the information needed to create comprehensive, tailored Cursor rules.

16. [Source 15] think({"reflection": "## Research Synthesis\n\n**Tech Stack Identified:**\n- Frontend: React 18 + TypeScript + Vite + Tailwind CSS + ShadCN UI (Radix primitives)\n- Backend: Node.js/Express + TypeScript\n- Database: Supabase (PostgreSQL)\n- API: Vercel serverless functions + Express backend\n- Payments: Polar (migrated from Stripe)\n- AI: Vertex AI integration\n- Testing: Vitest + React Testing Library + Playwright E2E\n- CI/CD: GitHub Actions + Vercel\n\n**Security Patterns Found:**\n- Helmet security headers with strict CSP\n- Rate limiting (express-rate-limit)\n- DOMPurify for XSS prevention\n- CSRF protection middleware\n- IP validation and bot detection\n- Supabase JWT auth verification\n\n**Code Style Conventions:**\n- TypeScript strict mode with `@typescript-eslint/no-explicit-any: error`\n- Accessibility-first (jsx-a11y WCAG 2.1 AA)\n- Import ordering (external \u2192 internal \u2192 parent/sibling)\n- Tailwind class ordering\n- React hooks rules enforced\n- No console.log (only warn/error allowed)\n\n**Component Patterns:**\n- TypeScript interfaces for Props/State\n- React.forwardRef with displayName\n- Context API with custom hooks (useAccordion, useTheme)\n- cn() utility for class merging\n- Comprehensive JSDoc documentation\n\n**API Patterns:**\n- Custom error classes hierarchy (ValidationError, AuthenticationError, etc.)\n- asyncHandler wrapper for error propagation\n- Joi validation schemas with reusable fields\n- Primary/fallback endpoint pattern\n- Request ID tracing\n\n**Testing Patterns:**\n- QueryClient wrapper for React Query\n- describe/it structure\n- getAllBy queries for multiple elements\n- API mocking with route interception\n- Mobile responsiveness testing\n\n**Confidence: HIGH** - I have all the information needed to create comprehensive, tailored Cursor rules."}): Reflection recorded. Continue with next action.
