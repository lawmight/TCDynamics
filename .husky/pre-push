#!/bin/sh
set -e
# Pre-push validation (fast checks before CI)
echo "ğŸ” Running pre-push checks..."

# Get repository root
REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null)"
if [ -z "$REPO_ROOT" ]; then
  echo "âŒ Unable to locate repository root. Make sure git is installed and you're inside the repo."
  exit 1
fi

cd "$REPO_ROOT"

# Frontend checks
FRONTEND_DIR="$REPO_ROOT/apps/frontend"
if [ -d "$FRONTEND_DIR" ]; then
  echo "ğŸ“ Running frontend lint..."
  cd "$FRONTEND_DIR"
  npm run lint || exit 1

  echo "ğŸ”§ Checking frontend TypeScript types..."
  npm run type-check || exit 1
  cd "$REPO_ROOT"
fi

# Backend checks
BACKEND_DIR="$REPO_ROOT/apps/backend"
if [ -d "$BACKEND_DIR" ]; then
  echo "ğŸ“ Running backend lint..."
  cd "$BACKEND_DIR"
  npm run lint || exit 1

  echo "ğŸ”§ Checking backend TypeScript types..."
  npm run type-check || exit 1
  cd "$REPO_ROOT"
fi

echo "âœ… Pre-push checks passed!"
echo "â„¹ï¸  Full test suite and build verification will run in CI"
