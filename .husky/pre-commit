#!/usr/bin/env sh
set -e
# Quick pre-commit checks (fast feedback)
echo "ğŸ” Running pre-commit checks..."

# Run lint-staged (ESLint + Prettier)
npx lint-staged || exit 1

# Type check TypeScript files
echo "ğŸ”§ Checking TypeScript types..."
npm run type-check

# Security checks
echo "ğŸ”’ Running security checks..."

# Frontend security audit (only high/critical)
echo "ğŸ“¦ Checking frontend dependencies..."
npm audit --audit-level=high || {
  echo "âŒ Frontend security audit failed - high/critical vulnerabilities found"
  echo "ğŸ’¡ Run 'npm audit fix' to fix automatically fixable issues"
  exit 1
}

# Backend security audit (only high/critical)
echo "ğŸ“¦ Checking backend dependencies..."
cd backend
npm audit --audit-level=high || {
  echo "âŒ Backend security audit failed - high/critical vulnerabilities found"
  echo "ğŸ’¡ Run 'npm audit fix' to fix automatically fixable issues"
  exit 1
}
cd ..

# Python security check (if safety is available)
echo "ğŸ Checking Python dependencies..."
if command -v safety >/dev/null 2>&1; then
  cd TCDynamics
  safety check --severity=high || {
    echo "âŒ Python security audit failed - high/critical vulnerabilities found"
    echo "ğŸ’¡ Run 'pip install --upgrade <package>' to fix issues"
    exit 1
  }
  cd ..
else
  echo "âš ï¸  Safety not installed - skipping Python security check"
  echo "ğŸ’¡ Install with: pip install safety"
fi

echo "âœ… All security checks passed!"

